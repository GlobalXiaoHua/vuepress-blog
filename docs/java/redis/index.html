<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.15" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #22272e;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>第一章 NoSQL数据库</title><meta name="description" content="">
    <link rel="preload" href="/assets/style-Bz3DBV7I.css" as="style"><link rel="stylesheet" href="/assets/style-Bz3DBV7I.css">
    <link rel="modulepreload" href="/assets/app-DXtlDOGr.js"><link rel="modulepreload" href="/assets/index.html-BBffd9_E.js">
    <link rel="prefetch" href="/assets/index.html-C424KpZ6.js" as="script"><link rel="prefetch" href="/assets/ts.html-BjVaeQWB.js" as="script"><link rel="prefetch" href="/assets/vue3.html-r2yTj9vX.js" as="script"><link rel="prefetch" href="/assets/index.html-C9Dzp4PI.js" as="script"><link rel="prefetch" href="/assets/index.html-CCUlahyo.js" as="script"><link rel="prefetch" href="/assets/index.html-DCKu8HG4.js" as="script"><link rel="prefetch" href="/assets/404.html-Fi_sP52e.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><!----><!----></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="首页"><!---->首页<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="前端笔记"><span class="title">前端笔记</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="前端笔记"><span class="title">前端笔记</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/docs/front/ts.html" aria-label="TypeScript"><!---->TypeScript<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/docs/front/vue3.html" aria-label="Vue3"><!---->Vue3<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Java笔记"><span class="title">Java笔记</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Java笔记"><span class="title">Java笔记</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/docs/java/design-mode/" aria-label="设计模式"><!---->设计模式<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/docs/java/kafka/" aria-label="Kafka"><!---->Kafka<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/docs/java/redis/" aria-label="Redis"><!---->Redis<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Python笔记"><span class="title">Python笔记</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Python笔记"><span class="title">Python笔记</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/docs/python/crawler/" aria-label="爬虫"><!---->爬虫<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="首页"><!---->首页<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="前端笔记"><span class="title">前端笔记</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="前端笔记"><span class="title">前端笔记</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/docs/front/ts.html" aria-label="TypeScript"><!---->TypeScript<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/docs/front/vue3.html" aria-label="Vue3"><!---->Vue3<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Java笔记"><span class="title">Java笔记</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Java笔记"><span class="title">Java笔记</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/docs/java/design-mode/" aria-label="设计模式"><!---->设计模式<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/docs/java/kafka/" aria-label="Kafka"><!---->Kafka<!----></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/docs/java/redis/" aria-label="Redis"><!---->Redis<!----></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Python笔记"><span class="title">Python笔记</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Python笔记"><span class="title">Python笔记</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/docs/python/crawler/" aria-label="爬虫"><!---->爬虫<!----></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">第一章 NoSQL数据库 <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="第一章-nosql数据库" tabindex="-1"><a class="header-anchor" href="#第一章-nosql数据库"><span>第一章 NoSQL数据库</span></a></h1><h2 id="学习目标" tabindex="-1"><a class="header-anchor" href="#学习目标"><span>学习目标</span></a></h2><p>1 了解什么是NoSQL 数据库及常见的NoSQL数据库</p><p>2 了解其他类型数据库</p><h2 id="第一节-nosql数据库概述" tabindex="-1"><a class="header-anchor" href="#第一节-nosql数据库概述"><span>第一节 NoSQL数据库概述</span></a></h2><h3 id="_1-1-什么是nosql数据库" tabindex="-1"><a class="header-anchor" href="#_1-1-什么是nosql数据库"><span>1.1 什么是NoSQL数据库</span></a></h3><blockquote><p>NoSQL(NoSQL = Not Only SQL )，意即“不仅仅是SQL”，泛指非关系型的数据库。</p></blockquote><blockquote><p>NoSQL 不依赖业务逻辑方式存储，而以简单的key-value模式存储。因此大大的增加了数据库的扩展能力。</p></blockquote><ul><li>不遵循SQL标准。</li><li>不支持ACID。</li><li>远超于SQL的性能。</li></ul><h3 id="_1-2-nosql适用的场景" tabindex="-1"><a class="header-anchor" href="#_1-2-nosql适用的场景"><span>1.2 NoSQL适用的场景</span></a></h3><ul><li>对数据高并发的读写</li><li>海量数据的读写</li><li>对数据高可扩展性的</li></ul><h3 id="_1-3-nosql不适用的场景" tabindex="-1"><a class="header-anchor" href="#_1-3-nosql不适用的场景"><span>1.3 NoSQL不适用的场景</span></a></h3><ul><li>需要事务支持</li><li>基于sql的结构化查询存储，处理复杂的关系查询</li></ul><h3 id="_1-4-常见nosql数据库" tabindex="-1"><a class="header-anchor" href="#_1-4-常见nosql数据库"><span>1.4 常见NoSQL数据库</span></a></h3><h4 id="_1-4-1-memcached" tabindex="-1"><a class="header-anchor" href="#_1-4-1-memcached"><span>1.4.1 Memcached</span></a></h4><p><img src="/assets/1_ZAenux9BxO-BYqSy0A8.png" alt=""></p><p>1 很早出现的NoSql数据库</p><p>2 <strong>数据都在内存中，一般不持久化</strong></p><p>3 支持简单的key-value模式，<strong>支持类型单一</strong></p><p>4 一般是作为<strong>缓存数据库</strong>辅助持久化的数据库</p><h4 id="_1-4-2-redis" tabindex="-1"><a class="header-anchor" href="#_1-4-2-redis"><span>1.4.2 Redis</span></a></h4><p><img src="/assets/2_zD1nWTB8pS-CDJ_5zFM.png" alt=""></p><p>1 几乎覆盖了Memcached的绝大部分功能</p><p>2 数据都在内存中，<strong>支持持久化，主要用作备份恢复</strong></p><p>3 除了支持简单的key-value模式，还支持多种数据结构的存储，比如 list、set、hash、zset等。</p><p>4 一般是作为<strong>缓存数据库</strong>辅助持久化的数据库</p><h4 id="_1-4-3-mongodb" tabindex="-1"><a class="header-anchor" href="#_1-4-3-mongodb"><span>1.4.3 MongoDB</span></a></h4><p><img src="/assets/3_DXOckvzGcV-sa9vStFp.png" alt=""></p><p>1 高性能、开源、模式自由(schema free)的<strong>文档型数据库</strong></p><p>2 数据都在内存中， 如果内存不足，把不常用的数据保存到硬盘</p><p>3 虽然是key-value模式，但是对value（尤其是<strong>json</strong>）提供了丰富的查询功能</p><p>4 支持二进制数据及大型对象</p><p>5 可以根据数据的特点<strong>替代RDBMS</strong> ，成为独立的数据库。或者配合RDBMS，存储特定的数据。</p><h2 id="第二节-db-engines数据库排名" tabindex="-1"><a class="header-anchor" href="#第二节-db-engines数据库排名"><span>第二节 DB-Engines数据库排名</span></a></h2><p>查看连接<a href="http://db-engines.com/en/ranking" title="http://db-engines.com/en/ranking" target="_blank" rel="noopener noreferrer"><strong>http://db-engines.com/en/ranking</strong></a></p><p><img src="/assets/image-20230627115200495-CUqHdEaB.png" alt="image-20230627115200495"></p><h1 id="第二章-redis简介和安装" tabindex="-1"><a class="header-anchor" href="#第二章-redis简介和安装"><span>第二章 Redis简介和安装</span></a></h1><h2 id="学习目标-1" tabindex="-1"><a class="header-anchor" href="#学习目标-1"><span>学习目标</span></a></h2><p>1 能够独立完成redis数据库的安装和启动方式调试</p><p>2 能够简单操作redis数据库</p><h2 id="第一节-redis简介和适用场景" tabindex="-1"><a class="header-anchor" href="#第一节-redis简介和适用场景"><span>第一节 Redis简介和适用场景</span></a></h2><ul><li><p>Redis是当前比较热门的NOSQL系统之一，它是一个开源的使用ANSI c语言编写的key-value存储系统（区别于MySQL的二维表格的形式存储。）</p></li><li><p>Redis数据都是缓存在计算机内存中，但是Redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，实现数据的持久化。</p></li><li><p>Redis读写速度快，Redis读取的速度是110000次/s，写的速度是81000次/s；</p></li><li><p>Redis的所有操作都是原子性的。</p></li><li><p>Redis支持多种数据结构：string（字符串），list（列表），hash（哈希），set（集合），zset(有序集合)</p></li><li><p>Redis支持集群部署</p></li><li><p>支持过期时间，支持事务，消息订阅</p></li></ul><h3 id="_1-1-配合关系型数据库做高速缓存" tabindex="-1"><a class="header-anchor" href="#_1-1-配合关系型数据库做高速缓存"><span>1.1 配合关系型数据库做高速缓存</span></a></h3><p>1 高频次，热门访问的数据，降低数据库IO</p><p><img src="/assets/h9_KHaeI98xIn-CBmES-QX.png" alt=""></p><h3 id="_1-2-多样的数据结构存储持久化数据" tabindex="-1"><a class="header-anchor" href="#_1-2-多样的数据结构存储持久化数据"><span>1.2 多样的数据结构存储持久化数据</span></a></h3><p><img src="/assets/h10_RMycEgflpU-DosbeY_M.png" alt=""></p><h2 id="第二节-redis的安装和基本操作" tabindex="-1"><a class="header-anchor" href="#第二节-redis的安装和基本操作"><span>第二节 Redis的安装和基本操作</span></a></h2><h3 id="_2-1-redis的官网和下载" tabindex="-1"><a class="header-anchor" href="#_2-1-redis的官网和下载"><span>2.1 Redis的官网和下载</span></a></h3><blockquote><p>官网</p></blockquote><table><thead><tr><th>Redis官方网站</th><th>Redis中文官方网站</th></tr></thead><tbody><tr><td><a href="http://redis.io" title="http://redis.io" target="_blank" rel="noopener noreferrer"><strong>http://redis.io</strong></a></td><td><a href="http://redis.cn/" title="http://redis.cn/" target="_blank" rel="noopener noreferrer">http://redis.cn/</a></td></tr></tbody></table><p><img src="/assets/image-20230627115445004-CxeQ-Dyu.png" alt="image-20230627115445004"></p><p><img src="/assets/image-20230627115514919-Bqpmv_mT.png" alt="image-20230627115514919"></p><h3 id="_2-2-redis安装" tabindex="-1"><a class="header-anchor" href="#_2-2-redis安装"><span>2.2 Redis安装</span></a></h3><blockquote><p>第一步 下载redis及版本选择</p></blockquote><ul><li><ol start="7"><li>0.10 for Linux（redis-7.0.10.tar.gz）或者安装新版本</li></ol><p><img src="/assets/image-20230627115822984-CZ2mVLdU.png" alt="image-20230627115822984"></p></li><li><p>不用考虑在windows环境下对Redis的支持</p></li></ul><p><img src="/assets/r3_ZbbjGyf50w-8u_gY223.png" alt=""></p><blockquote><p>第二步 下载安装最新版本的gcc编译器</p></blockquote><ul><li><p>安装C语言环境</p><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">yum -y install gcc</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>测试安装是否成功</p><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">gcc --version</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/assets/r4_yy-zDaF8fI-CSyzSW2E.png" alt=""></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">centos7自带的gcc版本(4.8.5)太旧导致redis高版本编译报错</span>
<span class="line">1）修改redis的安装目录:</span>
<span class="line">vim redis解压目录/src/Makefile</span>
<span class="line">PREFIX?=/usr/local/redis</span>
<span class="line">2) 更新gcc的版本为9(centos7自带的版本是4.8.5)</span>
<span class="line">执行 yum -y install centos-release-scl</span>
<span class="line">执行 yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9</span>
<span class="line">执行 scl enable devtoolset-9 bash</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><blockquote><p>第三步 上传redis-7.0.10.tar.gz放/opt目录</p></blockquote><blockquote><p>第四步 解压命令：tar -zxvf redis-7.0.10.tar.gz</p></blockquote><blockquote><p>第五步 解压完成后进入目录：cd redis-7.0.10</p></blockquote><blockquote><p>第六步 在redis-7.0.10目录下再次执行make命令（只是编译好）</p></blockquote><ul><li><p>如果没有准备好C语言编译环境，make 会报错</p><ul><li>Jemalloc/jemalloc.h：没有那个文件 <img src="/assets/r5_7hJkvtN7Ei-CNweNbL1.png" alt=""></li><li>此时解决方案:运行make distclean</li></ul><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">make disclean</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/assets/r6_XYBfZILlLQ-B6sdjD4T.png" alt=""></p><ul><li>安装好 gcc后再次make <img src="/assets/r7_E9OzTv8geu-DFVduYR3.png" alt=""></li></ul></li></ul><blockquote><p>第七步 跳过make test,继续执行make install</p></blockquote><p><img src="/assets/r8_HUpdPPasWH-CUIJzrr3.png" alt=""></p><h3 id="_2-3-redis的启动和停止" tabindex="-1"><a class="header-anchor" href="#_2-3-redis的启动和停止"><span>2.3 Redis的启动和停止</span></a></h3><h4 id="_2-3-1-查看安装目录" tabindex="-1"><a class="header-anchor" href="#_2-3-1-查看安装目录"><span>2.3.1 查看安装目录</span></a></h4><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">cd /usr/local/redis/bin</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>redis-benchmark:性能测试工具，可以在自己本子运行，看看自己本子性能如何</li><li>redis-check-aof：修复有问题的AOF文件，rdb和aof后面讲</li><li>redis-check-dump：修复有问题的dump.rdb文件</li><li>redis-sentinel：Redis集群使用</li><li>redis-server：Redis服务器启动命令</li><li>redis-cli：客户端，操作入口</li></ul><h4 id="_2-3-2-前台启动方式" tabindex="-1"><a class="header-anchor" href="#_2-3-2-前台启动方式"><span>2.3.2 前台启动方式</span></a></h4><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">redis-server</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>不推荐原因: 窗口不能关闭,关闭则服务停止</li></ul><h4 id="_2-3-3-后台启动方式" tabindex="-1"><a class="header-anchor" href="#_2-3-3-后台启动方式"><span>2.3.3 后台启动方式</span></a></h4><ul><li>在/root目录下创建myredis目录,用于存储启动使用的配置文件</li></ul><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">cd /root</span>
<span class="line">mkdir myredis</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>拷贝一份redis.conf到myredis目录</li></ul><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">cp /opt/redis-7.0.10/redis.conf /root/myredis</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>修改配置文件中的内容 daemonize no改成yes</li></ul><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">修改redis.conf(257行附近?或者搜索 ) 文件将里面的daemonize no 改成 yes，让服务在后台启动  </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>修改配置文件中的 bind ,注释该配置,取消绑定仅主机登录</li><li>修改protected-mode 为no,取消保护模式</li><li>以指定的配置文件启动redis</li></ul><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">redis-server /root/myredis/redis.conf</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>查看服务启动状态</li></ul><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">ps -ef | grep redis</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_2-3-4-通过客户端连接redis" tabindex="-1"><a class="header-anchor" href="#_2-3-4-通过客户端连接redis"><span>2.3.4 通过客户端连接redis</span></a></h4><ul><li>通过客户端指令连接redis</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">redis-cli</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>如果想退出客户端可以 按 Ctrl+c ,退出客户端不会关闭redis服务</li><li>通过客户端连接制定端口下的redis (默认6379)</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">redis-cli -p 6379</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>连接后,测试与redis的连通性</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">ping</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_2-3-5-停止redis服务" tabindex="-1"><a class="header-anchor" href="#_2-3-5-停止redis服务"><span>2.3.5 停止redis服务</span></a></h4><ul><li>单实例非客户端连接模式下关闭服务</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">redis-cli shutdown</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>在客户端连接模式下,直接使用shutdown关闭当前连接的redis服务</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">shutdown</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>多实例关闭指定端口的redis服务</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">redis-cli -p 6379 shutdown</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_2-3-6-redis小知识及操作" tabindex="-1"><a class="header-anchor" href="#_2-3-6-redis小知识及操作"><span>2.3.6 Redis小知识及操作</span></a></h4><h5 id="_1-端口号-6379-由来" tabindex="-1"><a class="header-anchor" href="#_1-端口号-6379-由来"><span>（1）端口号 6379 由来</span></a></h5><p>Alessia <strong>Merz</strong></p><h5 id="_2-数据库操作" tabindex="-1"><a class="header-anchor" href="#_2-数据库操作"><span>（2）数据库操作</span></a></h5><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">默认16个数据库，类似数组下标从0开始，初始默认使用0号库</span>
<span class="line">使用命令 select &lt;dbid&gt;来切换数据库。如: select 8</span>
<span class="line">统一密码管理，所有库同样密码。</span>
<span class="line">dbsize查看当前数据库的key的数量</span>
<span class="line">flushdb清空当前库</span>
<span class="line">flushall通杀全部库</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-redis单线程-多路复用" tabindex="-1"><a class="header-anchor" href="#_3-redis单线程-多路复用"><span>（3）Redis单线程+多路复用</span></a></h5><p>多路复用是指使用一个线程来检查多个文件描述符（Socket）的就绪状态，比如调用select和poll函数，传入多个文件描述符，如果有一个文件描述符就绪，则返回，否则阻塞直到超时。得到就绪状态后进行真正的操作可以在同一个线程里执行，也可以启动线程执行（比如使用线程池）</p><ul><li>多路：指的是多个网络连接客户端</li><li>复用：指的是复用同一个线程</li><li>I/O 多路复用：其实是使用一个线程来检查多个 Socket 的就绪状态，在单个线程中通过记录跟踪每一个 socket（I/O流）的状态来管理处理多个 I/O 流。</li></ul><p><img src="/assets/image-20230706100628816-D1AJaYHb.png" alt="image-20230706100628816"></p><p>1、一个 socket 客户端与服务端连接时，会生成对应一个套接字描述符(套接字描述符是文件描述符的一种)，每一个 socket 网络连接其实都对应一个文件描述符。</p><ul><li>文件描述符(file descriptor)： Linux 系统中，把一切都看做是文件，当进程打开现有文件或创建新文件时，内核向进程返回一个文件描述符。可以理解文件描述符是一个索引，这样，要操作文件的时候，我们直接找到索引就可以对其进行操作了。我们将这个索引叫做文件描述符（file descriptor），简称fd。</li></ul><p>2、多个客户端与服务端连接时，Redis 使用 「I/O 多路复用程序」 将客户端 socket 对应的 FD 注册到监听列表(一个队列)中。当客服端执行 read、write 等操作命令时，I/O 多路复用程序会将命令封装成一个事件，并绑定到对应的 FD 上。</p><p>3、「文件事件处理器」使用 I/O 多路复用模块同时监控多个文件描述符（fd）的读写情况，当 accept、read、write 和 close 文件事件产生时，文件事件处理器就会回调 FD 绑定的事件处理器进行处理相关命令操作。</p><p>4、文件事件分派器接收到I/O多路复用程序传来的套接字fd后，并根据套接字产生的事件类型，将套接字派发给相应的事件处理器来进行处理相关命令操作。</p><p>5、整个文件事件处理器是在单线程上运行的，但是通过 I/O 多路复用模块的引入，实现了同时对多个 FD 读写的监控，当其中一个 client 端达到写或读的状态，文件事件处理器就马上执行，从而就不会出现 I/O 堵塞的问题，提高了网络通信的性能。</p><h1 id="第三章-redis常用数据类型和命令" tabindex="-1"><a class="header-anchor" href="#第三章-redis常用数据类型和命令"><span>第三章 Redis常用数据类型和命令</span></a></h1><h2 id="学习目标-2" tabindex="-1"><a class="header-anchor" href="#学习目标-2"><span>学习目标</span></a></h2><p>1 什么是Redis的五大数据类型</p><p>redis的存储时 key-value形式的,这里的五大类型指的是 value的五种数据类型</p><p>2 相关命令</p><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">1 如何对键进行一些操作</span>
<span class="line">2 String类型的value值如何进行操作</span>
<span class="line">3 List 类型的value如何进行操作</span>
<span class="line">4 Set类型的value如何进行操作</span>
<span class="line">5 Hash类型的value如何进行操作</span>
<span class="line">6 Zset类型的value如何进行操作</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3 redis常见数据类型操作命令的帮助文档</p><p><a href="http://www.redis.cn/commands.html" title="http://www.redis.cn/commands.html" target="_blank" rel="noopener noreferrer">http://www.redis.cn/commands.html</a></p><h2 id="第一节-key操作的相关命令" tabindex="-1"><a class="header-anchor" href="#第一节-key操作的相关命令"><span>第一节 key操作的相关命令</span></a></h2><table><thead><tr><th>语法</th><th>功能</th></tr></thead><tbody><tr><td>keys *</td><td>查看当前库所有key (匹配：keys *1)</td></tr><tr><td>exists key</td><td>判断某个key是否存在</td></tr><tr><td>type key</td><td>查看你的key是什么类型</td></tr><tr><td>del key</td><td>删除指定的key数据</td></tr><tr><td>unlink key</td><td>非阻塞删除,仅将keys从keyspace元数据中删除，真正的删除会在后续异步操作</td></tr><tr><td>expire key 10</td><td>10秒钟：为给定的key设置过期时间</td></tr><tr><td>ttl key</td><td>查看还有多少秒过期，-1表示永不过期，-2表示已过期</td></tr><tr><td>select</td><td>命令切换数据库</td></tr><tr><td>dbsize</td><td>查看当前数据库的key的数量</td></tr><tr><td>flushdb</td><td>清空当前库</td></tr><tr><td>flushall</td><td>清空全部库</td></tr></tbody></table><h2 id="第二节-字符串类型-string" tabindex="-1"><a class="header-anchor" href="#第二节-字符串类型-string"><span>第二节 字符串类型(String)</span></a></h2><h3 id="_2-1-简介" tabindex="-1"><a class="header-anchor" href="#_2-1-简介"><span>2.1 简介</span></a></h3><p>1 String是Redis最基本的类型，你可以理解成与Memcached一模一样的类型，一个key对应一个value。</p><p>2 String类型是二进制安全的。意味着Redis的string可以包含任何数据。比如jpg图片或者序列化的对象。</p><p>3 String类型是Redis最基本的数据类型，一个Redis中字符串value最多可以是512M</p><h3 id="_2-2-常用命令" tabindex="-1"><a class="header-anchor" href="#_2-2-常用命令"><span>2.2 常用命令</span></a></h3><table><thead><tr><th>语法</th><th>解释</th></tr></thead><tbody><tr><td>set &lt;key&gt;&lt;value&gt;</td><td>添加键值对</td></tr><tr><td></td><td>NX：当数据库中key不存在时，可以将key-value添加数据库</td></tr><tr><td></td><td>XX：当数据库中key存在时，可以将key-value添加数据库，与NX参数互斥</td></tr><tr><td></td><td>EX：key的超时秒数</td></tr><tr><td></td><td>PX：key的超时毫秒数，与EX互斥</td></tr><tr><td>get &lt;key&gt;</td><td>查询对应键值</td></tr><tr><td>append &lt;key&gt;&lt;value&gt;</td><td>将给定的&lt;value&gt; 追加到原值的末尾</td></tr><tr><td>strlen &lt;key&gt;</td><td>获得值的长度</td></tr><tr><td>setnx &lt;key&gt;&lt;value&gt;</td><td>只有在 key 不存在时 设置 key 的值</td></tr><tr><td>incr &lt;key&gt;</td><td>将 key 中储存的数字值增1,只能对数字值操作，如果为空，新增值为1</td></tr><tr><td>decr &lt;key&gt;</td><td>将 key 中储存的数字值减1,只能对数字值操作，如果为空，新增值为-1</td></tr><tr><td>incrby / decrby &lt;key&gt;&lt;步长&gt;</td><td>将 key 中储存的数字值增减。自定义步长</td></tr><tr><td>mset &lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt; .....</td><td>同时设置一个或多个 key-value对</td></tr><tr><td>mget &lt;key1&gt;&lt;key2&gt;&lt;key3&gt; .....</td><td>同时获取一个或多个 value</td></tr><tr><td>msetnx &lt;key1&gt;&lt;value1&gt;&lt;key2&gt;&lt;value2&gt; .....</td><td>同时设置一个或多个 key-value 对，当且仅当所有给定 key 都不存在。有一个失败则都失败(原子性)</td></tr><tr><td>getrange &lt;key&gt;&lt;起始位置&gt;&lt;结束位置&gt;</td><td>获得值的范围，类似java中的substring，<strong>前包，后包</strong></td></tr><tr><td>setrange &lt;key&gt;&lt;起始位置&gt;&lt;value&gt;</td><td>用 &lt;value&gt; 覆写&lt;key&gt;所储存的字符串值，从&lt;起始位置&gt;开始(<strong>索引从0</strong>开始)。</td></tr><tr><td>setex &lt;key&gt; &lt;过期时间&gt; &lt;value&gt;</td><td>设置键值的同时，设置过期时间，单位秒。</td></tr><tr><td>getset &lt;key&gt;&lt;value&gt;</td><td>以新换旧，设置了新值同时获得旧值。</td></tr></tbody></table><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">●SET KEY VALUE [EX SECONDS] [PX MILLISECONDS] [NX|XX]</span>
<span class="line">    给KEY设置一个string类型的值。</span>
<span class="line">    EX参数用于设置存活的秒数。</span>
<span class="line">    PX参数用于设置存活的毫秒数。</span>
<span class="line">    NX参数表示当前命令中指定的KEY不存在才行。</span>
<span class="line">    XX参数表示当前命令中指定的KEY存在才行。</span>
<span class="line">​</span>
<span class="line">    # 设置key为hi，value值为byebye，这个key-value的生存时长是5秒钟</span>
<span class="line">    set hi byebye ex 5  </span>
<span class="line">●GET KEY</span>
<span class="line">    根据key得到值，只能用于string类型。</span>
<span class="line">●APPEND KEY VALUE</span>
<span class="line">    把指定的value追加到KEY对应的原来的值后面，返回值是追加后字符串长度</span>
<span class="line">●STRLEN KEY</span>
<span class="line">    直接返回字符串长度</span>
<span class="line">●INCR KEY</span>
<span class="line">    自增1（要求：参与运算的数据必须是且不能超过整数Integer范围）</span>
<span class="line">●DECR KEY</span>
<span class="line">    自减1（要求：参与运算的数据必须是整数且不能超过整数Integer范围）</span>
<span class="line">●INCRBY KEY INCREMENT</span>
<span class="line">    原值+INCREMENT（要求：参与运算的数据必须是整数且不能超过整数Integer范围）</span>
<span class="line">●DECRBY KEY DECREMENT</span>
<span class="line">    原值-DECREMENT（要求：参与运算的数据必须是整数且不能超过整数Integer范围）</span>
<span class="line">●GETRANGE KEY START END</span>
<span class="line">    从字符串中取指定的一段，索引从0开始</span>
<span class="line">    START是开始取值的索引</span>
<span class="line">    END是结束取值的索引</span>
<span class="line">​</span>
<span class="line">    getrange hello 0 3     -&gt;   worl    -&gt; [0,3] 闭区间</span>
<span class="line">​</span>
<span class="line">●SETRANGE KEY OFFSET VALUE</span>
<span class="line">    从offset（从0开始的索引）开始使用VALUE进行替换</span>
<span class="line">    包含offset位置</span>
<span class="line">●SETEX KEY SECONDS VALUE</span>
<span class="line">    设置KEY,VALUE时指定存在秒数</span>
<span class="line">●SETNX KEY VALUE</span>
<span class="line">    新建字符串类型的键值对</span>
<span class="line">●MSET KEY VALUE [KEY VALUE ...]</span>
<span class="line">    一次性设置一组多个键值对</span>
<span class="line">●MGET KEY [KEY ...]</span>
<span class="line">    一次性指定多个KEY，返回它们对应的值，没有值的KEY返回值是(nil)</span>
<span class="line">●MSETNX KEY VALUE [KEY VALUE ...]</span>
<span class="line">    一次性新建多个值</span>
<span class="line">●GETSET KEY VALUE</span>
<span class="line">    设置新值，同时能够将旧值返回</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>redis指令运行的原子性</p></blockquote><ul><li>所谓原子操作是指不会被线程调度机制打断的操作；这种操作一旦开始，就一直运行到结束，中间不会有任何 context switch （切换到另一个线程）。 <ul><li>（1）在单线程中， 能够在单条指令中完成的操作都可以认为是&quot;原子操作&quot;，因为中断只能发生于指令之间。</li><li>（2）在多线程中，不能被其它进程（线程）打断的操作就叫原子操作。</li><li>（3）Redis单命令的原子性主要得益于的单线程。</li></ul></li></ul><blockquote><p>问题 JAVA中的 a++ 是否具有原子性</p></blockquote><p><strong>原子性：<strong>即不可分割性。比如 a=0；（a非long和double类型） 这个操作是不可分割的，那么我们说这个操作是原子操作。再比如：a++； 这个操作实际是a = a + 1；是可分割的，所以他不是一个原子操作。非原子操作都会存在线程安全问题，需要</strong>使用同步技术（sychronized）或者锁（Lock）来让它变成一个原子操作</strong>。一个操作是原子操作，那么我们称它具有原子性。</p><h3 id="_2-3-数据结构" tabindex="-1"><a class="header-anchor" href="#_2-3-数据结构"><span>2.3 数据结构</span></a></h3><p>String的数据结构为简单动态字符串(Simple Dynamic String,缩写SDS)。是可以修改的字符串，内部结构实现上类似于Java的ArrayList，采用预分配冗余空间的方式来减少内存的频繁分配.</p><p><img src="/assets/t2_PyJD5svSPN-Da06CmUs.png" alt=""></p><p>如图中所示，内部为当前字符串实际分配的空间capacity一般要高于实际字符串长度len。当字符串长度小于1M时，扩容都是加倍现有的空间，如果超过1M，扩容时一次只会多扩1M的空间。需要注意的是字符串最大长度为512M。</p><h2 id="第三节-redis-列表-list" tabindex="-1"><a class="header-anchor" href="#第三节-redis-列表-list"><span>第三节 Redis 列表(List)</span></a></h2><h3 id="_3-1-简介" tabindex="-1"><a class="header-anchor" href="#_3-1-简介"><span>3.1 简介</span></a></h3><p>单键多值, 一个键下的value是一个List.Redis 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）。它的底层实际是个双向链表，对两端的操作性能很高，通过索引下标的操作中间的节点性能会较差。</p><p><img src="/assets/t3_-u-scVSY5m-e65W0PWH.png" alt=""></p><h3 id="_3-2-常用命令" tabindex="-1"><a class="header-anchor" href="#_3-2-常用命令"><span>3.2 常用命令</span></a></h3><table><thead><tr><th>语法</th><th>功能</th></tr></thead><tbody><tr><td>lpush/rpush &lt;key&gt;&lt;value1&gt;&lt;value2&gt;&lt;value3&gt; ....</td><td>从左边/右边插入一个或多个值。</td></tr><tr><td>lpop/rpop &lt;key&gt;</td><td>从左边/右边吐出一个值。值在键在，值光键亡。</td></tr><tr><td>rpoplpush &lt;key1&gt;&lt;key2&gt;</td><td>从&lt;key1&gt;列表右边吐出一个值，插到&lt;key2&gt;列表左边</td></tr><tr><td>lrange &lt;key&gt;&lt;start&gt;&lt;stop&gt;</td><td>按照索引下标获得元素(从左到右)</td></tr><tr><td></td><td>0左边第一个，-1右边第一个，（0-1表示获取所有）</td></tr><tr><td>lindex &lt;key&gt;&lt;index&gt;</td><td>按照索引下标获得元素(从左到右)</td></tr><tr><td>llen &lt;key&gt;</td><td>获得列表长度</td></tr><tr><td>linsert &lt;key&gt; before &lt;value&gt;&lt;newvalue&gt;</td><td>在&lt;value&gt;的前面插入&lt;newvalue&gt;插入值</td></tr><tr><td>linsert &lt;key&gt; after &lt;value&gt;&lt;newvalue&gt;</td><td>在&lt;value&gt;的后面插入&lt;newvalue&gt;插入值</td></tr><tr><td>lrem &lt;key&gt;&lt;n&gt;&lt;value&gt;</td><td>从左边删除n个value(从左到右)</td></tr><tr><td>lset&lt;key&gt;&lt;index&gt;&lt;value&gt;</td><td>将列表key下标为index的值替换成value</td></tr></tbody></table><p>●LPUSH key value [value ...] 针对key指定的list，从左边放入元素</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">lpush stulist jim tom lucy kate jim lucy</span>
<span class="line">(integer) 6</span>
<span class="line">可以存放重复的数据,返回的是保存成功的元素的个数</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>●LRANGE key start stop 根据list集合的索引打印元素数据 正着数：0,1,2,3,... 倒着数：-1,-2,-3,...</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">lrange stulist 0 -1</span>
<span class="line">我们发现元素的顺序和刚刚添加的顺序正好相反，其实很好理解，先添加的挤到末尾去了（压到下面去了）</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>●RPUSH key value [value ...] 针对key指定的list，从右边放入元素</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">rpush stulist a b c d</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>●LLEN key 返回list集合的长度</p><p>●LPOP key 从左边弹出一个元素。 弹出=返回+删除。</p><p>●RPOP key 从右边弹出一个元素。</p><p>●RPOPLPUSH source destination 从source中RPOP一个元素，LPUSH到destination中</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">RPOPLPUSH stulist stulist</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>●LINDEX key index 根据索引从集合中取值</p><p>●LINSERT key BEFORE|AFTER pivot value 在pivot指定的值前面或后面插入value 如果pivot值有重复的，那么就从左往右数，以第一个遇到的pivot为基准 BEFORE表示放在pivot前面 AFTER表示放在pivot后面</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">linsert stulist after jim hello</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>●LPUSHX key value 只能针对存在的list执行LPUSH</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">lpushx stulist2 ab bc cd</span>
<span class="line"># 因为stulist2这个key不存在，则添加失败</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>●LREM key count value 根据count指定的数量从key对应的list中删除value 具体执行时从左往右删除，遇到一个删一个，删完为止</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">REM 代表 remove 删除</span>
<span class="line">如果写的count超过实际找到的元素个数也不会报错，有几个删除几个</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>●LSET key index value 把指定索引位置的元素替换为另一个值</p><p>●LTRIM key start stop 仅保留指定区间的数据，两边的数据被删除</p><h3 id="_3-3-数据结构" tabindex="-1"><a class="header-anchor" href="#_3-3-数据结构"><span>3.3 数据结构</span></a></h3><p>List的数据结构为快速链表quickList。首先在列表元素较少的情况下会使用一块连续的内存存储，这个结构是ziplist，也即是压缩列表。它将所有的元素紧挨着一起存储，分配的是一块连续的内存。当数据量比较多的时候才会改成quicklist。因为普通的链表需要的附加指针空间太大，会比较浪费空间。比如这个列表里存的只是int类型的数据，结构上还需要两个额外的指针prev和next。</p><p><img src="/assets/t4_m8O96K0uZ0-CKIQKUP4.png" alt=""></p><p>Redis将链表和ziplist结合起来组成了quicklist。也就是将多个ziplist使用双向指针串起来使用。这样既满足了快速的插入删除性能，又不会出现太大的空间冗余。</p><h2 id="第四节redis-集合-set" tabindex="-1"><a class="header-anchor" href="#第四节redis-集合-set"><span>第四节Redis 集合(Set)</span></a></h2><h3 id="_4-1-简介" tabindex="-1"><a class="header-anchor" href="#_4-1-简介"><span>4.1 简介</span></a></h3><p> Redis set对外提供的功能与list类似是一个列表的功能，特殊之处在于set是可以<strong>自动排重</strong>的，当你需要存储一个列表数据，又不希望出现重复数据时，set是一个很好的选择，并且set提供了判断某个成员是否在一个set集合内的重要接口，这个也是list所不能提供的。</p><p> Redis的Set是string类型的无序集合。它底层其实是一个value为null的hash表，所以添加，删除，查找的<strong>复杂度都是O(1)</strong>。一个算法，随着数据的增加，执行时间的长短，如果是O(1)，数据增加，查找数据的时间不变 </p><h3 id="_4-2-常用命令" tabindex="-1"><a class="header-anchor" href="#_4-2-常用命令"><span>4.2 常用命令</span></a></h3><table><thead><tr><th>语法</th><th>功能</th></tr></thead><tbody><tr><td>sadd &lt;key&gt;&lt;value1&gt;&lt;value2&gt; .....</td><td>将一个或多个 member 元素加入到集合 key 中，已经存在的 member 元素将被忽略</td></tr><tr><td>smembers &lt;key&gt;</td><td>取出该集合的所有值。</td></tr><tr><td>sismember &lt;key&gt;&lt;value&gt;</td><td>判断集合&lt;key&gt;是否为含有该&lt;value&gt;值，有1，没有0</td></tr><tr><td>scard&lt;key&gt;</td><td>返回该集合的元素个数。</td></tr><tr><td>srem &lt;key&gt;&lt;value1&gt;&lt;value2&gt; ....</td><td>删除集合中的某个元素。</td></tr><tr><td>spop &lt;key&gt;</td><td>随机从该集合中吐出一个值</td></tr><tr><td>spop &lt;key&gt;&lt;N&gt;</td><td>随机从该集合中吐出N个值。</td></tr><tr><td>srandmember &lt;key&gt;&lt;n&gt;</td><td>随机从该集合中取出n个值。不会从集合中删除 。</td></tr><tr><td>smove &lt;source&gt;&lt;destination&gt;&lt;value&gt;</td><td>把集合中一个值从一个集合移动到另一个集合</td></tr><tr><td>sinter &lt;key1&gt;&lt;key2&gt;</td><td>返回两个集合的交集元素。</td></tr><tr><td>sunion &lt;key1&gt;&lt;key2&gt;</td><td>返回两个集合的并集元素。</td></tr><tr><td>sdiff &lt;key1&gt;&lt;key2&gt;</td><td>返回两个集合的<strong>差集</strong>元素(key1中的，不包含key2中的)</td></tr></tbody></table><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">SADD key member [member ...]</span>
<span class="line">给key指定的set集合中存入数据，set会自动去重</span>
<span class="line">SMEMBERS key</span>
<span class="line">返回可以指定的set集合中所有的元素</span>
<span class="line">SCARD key</span>
<span class="line">返回集合中元素的数量</span>
<span class="line">SISMEMBER key member</span>
<span class="line">检查当前指定member是否是集合中的元素</span>
<span class="line"> 	返回1：表示是集合中的元素</span>
<span class="line"> 	返回0：表示不是集合中的元素</span>
<span class="line">SREM key member [member ...]</span>
<span class="line">从集合中删除元素</span>
<span class="line">SINTER key [key ...]</span>
<span class="line">将指定的集合进行“交集”操作</span>
<span class="line"> 	集合A：a,b,c</span>
<span class="line"> 	集合B：b,c,d</span>
<span class="line"> 	交集：b,c</span>
<span class="line">SUNION key [key ...]</span>
<span class="line">将指定的集合执行“并集”操作</span>
<span class="line"> 	集合A：a,b,c</span>
<span class="line"> 	集合B：b,c,d</span>
<span class="line"> 	并集：a,b,c,d</span>
<span class="line">SINTERSTORE destination key [key ...]</span>
<span class="line">取交集后存入destination , store这个单词表示保存</span>
<span class="line">SUNIONSTORE destination key [key ...]</span>
<span class="line">SDIFF key [key ...]</span>
<span class="line">将指定的集合执行“差集”操作</span>
<span class="line"> 	集合A：a,b,c</span>
<span class="line"> 	集合B：b,c,d</span>
<span class="line"> 	A对B执行diff：a</span>
<span class="line"> 	相当于：A-交集部分</span>
<span class="line">SDIFFSTORE destination key [key ...]</span>
<span class="line">SMOVE source destination member</span>
<span class="line">把member从source移动到destination</span>
<span class="line">SRANDMEMBER key [count]</span>
<span class="line">从集合中随机返回count个数量的元素，count不指定就返回1个（数据有可能重复出现）</span>
<span class="line">SPOP key [count]</span>
<span class="line">从集合中随机弹出count个数量的元素，count不指定就弹出1个（保证不会有重复数据出现）</span>
<span class="line">SSCAN key cursor [MATCH pattern] [COUNT count]</span>
<span class="line">基于游标的遍历。cursor是游标值，第一次显示第一块内容时，游标取值为0；根据后续返回的新的游标值获取下一块数据。直到游标值变成0，说明数据遍历完成</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-数据结构" tabindex="-1"><a class="header-anchor" href="#_4-2-数据结构"><span>4.2 数据结构</span></a></h3><p>Set数据结构是dict字典，字典是用哈希表实现的。Java中HashSet的内部实现使用的是HashMap，只不过所有的value都指向同一个对象。Redis的set结构也是一样，它内部也使用hash结构，所有value都指向同一个内部值。</p><h2 id="第五节-redis-哈希-hash" tabindex="-1"><a class="header-anchor" href="#第五节-redis-哈希-hash"><span>第五节 Redis 哈希(Hash)</span></a></h2><h3 id="_5-1-简介" tabindex="-1"><a class="header-anchor" href="#_5-1-简介"><span>5.1 简介</span></a></h3><p>Redis hash 是一个键值对集合。Redis hash是一个string类型的field和value的映射表，hash特别适合用于存储对象。类似Java里面的Map&lt;String,Object&gt;用户ID为查找的key，存储的value用户对象包含姓名，年龄，生日等信息</p><ul><li><p>方式1 单key+序列化 .问题:每次修改用户的某个属性需要，先反序列化改好后再序列化回去。开销较大。</p><p><img src="/assets/image-20230706110321231-B_UyJ2U-.png" alt="image-20230706110321231"></p></li><li><p>方式2 多key-value .问题:用户ID数据冗余 </p><p><img src="/assets/image-20230706110341117-irFk2H0R.png" alt="image-20230706110341117"></p></li><li><p>方式3 单key + 多(field+value)</p></li></ul><p><img src="/assets/image-20230706110256007-Dv8gE_XG.png" alt="image-20230706110256007"></p><ul><li><strong>通过 key(用户ID) + field(属性标签) 就可以操作对应属性数据了，既不需要重复存储数据，也不会带来序列化和并发修改控制的问题</strong></li></ul><h3 id="_5-2-常用命令" tabindex="-1"><a class="header-anchor" href="#_5-2-常用命令"><span>5.2 常用命令</span></a></h3><table><thead><tr><th>语法</th><th>功能</th></tr></thead><tbody><tr><td>hset &lt;key&gt;&lt;field&gt;&lt;value&gt;</td><td>给&lt;key&gt;集合中的 &lt;field&gt;键赋值&lt;value&gt;</td></tr><tr><td>hget &lt;key1&gt;&lt;field&gt;</td><td>从&lt;key1&gt;集合&lt;field&gt;取出 value</td></tr><tr><td>hmset &lt;key1&gt;&lt;field1&gt;&lt;value1&gt;&lt;field2&gt;&lt;value2&gt;...</td><td>批量设置hash的值</td></tr><tr><td>hexists&lt;key1&gt;&lt;field&gt;</td><td>查看哈希表 key 中，给定域 field 是否存在。</td></tr><tr><td>hkeys &lt;key&gt;</td><td>列出该hash集合的所有field</td></tr><tr><td>hvals &lt;key&gt;</td><td>列出该hash集合的所有value</td></tr><tr><td>hincrby &lt;key&gt;&lt;field&gt;&lt;increment&gt;</td><td>为哈希表 key 中的域 field 的值加上增量 1 -1</td></tr><tr><td>hsetnx &lt;key&gt;&lt;field&gt;&lt;value&gt;</td><td>将哈希表 key 中的域 field 的值设置为 value ，当且仅当域 field 不存在 .</td></tr></tbody></table><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Map&lt;String,String&gt; hashmap01 = new HashMap&lt;String,String&gt;();</span>
<span class="line">hashmap01.put(&quot;s01&quot;,&quot;jim&quot;);</span>
<span class="line">hashmap01.put(&quot;s02&quot;,&quot;tom&quot;);</span>
<span class="line">-----------------------------------</span>
<span class="line">- HSET key field value</span>
<span class="line">插入新数据返回1</span>
<span class="line"> 	修改旧数据返回0</span>
<span class="line">hset hashmap01 s01 jim</span>
<span class="line">hset hashmap01 s02 tom</span>
<span class="line">- HKEYS key</span>
<span class="line">hkeys hashmap01</span>
<span class="line">查询出的结果：</span>
<span class="line">1) &quot;s01&quot;</span>
<span class="line">2) &quot;s02&quot;</span>
<span class="line">- HVALS key</span>
<span class="line">hvals hashmap01</span>
<span class="line">1) &quot;jim&quot;</span>
<span class="line">2) &quot;tom&quot;</span>
<span class="line">- HGETALL key</span>
<span class="line">hgetall hashmap01</span>
<span class="line">1) &quot;s01&quot;</span>
<span class="line">2) &quot;jim&quot;</span>
<span class="line">3) &quot;s02&quot;</span>
<span class="line">4) &quot;tom&quot;</span>
<span class="line">- HGET key field</span>
<span class="line">hget hashmap01 s01</span>
<span class="line">&quot;jim&quot;</span>
<span class="line">hget hashmap01 s03</span>
<span class="line">(nil)</span>
<span class="line">- HLEN key</span>
<span class="line">- HEXISTS key field</span>
<span class="line">hexists hashmap01 s01</span>
<span class="line">(integer) 1</span>
<span class="line">hexists hashmap01 s03</span>
<span class="line">(integer) 0</span>
<span class="line">- HDEL key field [field ...]</span>
<span class="line">- HINCRBY key field increment</span>
<span class="line">- HMGET key field [field ...]</span>
<span class="line">- hmget hashmap01 s01 s03 s05 s07</span>
<span class="line">1) &quot;jim&quot;</span>
<span class="line">2) &quot;lucy&quot;</span>
<span class="line">3) &quot;rose&quot;</span>
<span class="line">4) (nil)</span>
<span class="line"> </span>
<span class="line">- HMSET key field value [field value ...]</span>
<span class="line">hmset hashmap01 s02 tom s03 lucy s04 kate s05 rose s06 spring</span>
<span class="line">- HSETNX key field value</span>
<span class="line">要求field是新建的</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-数据结构" tabindex="-1"><a class="header-anchor" href="#_5-3-数据结构"><span>5.3 数据结构</span></a></h3><p>Hash类型对应的数据结构是两种：ziplist（压缩列表），hashtable（哈希表）。当field-value长度较短且个数较少时，使用ziplist，否则使用hashtable。</p><h2 id="第六节-redis-有序集合zset" tabindex="-1"><a class="header-anchor" href="#第六节-redis-有序集合zset"><span>第六节 Redis 有序集合Zset</span></a></h2><h3 id="_6-1-简介" tabindex="-1"><a class="header-anchor" href="#_6-1-简介"><span>6.1 简介</span></a></h3><p>Redis有序集合zset与普通集合set非常相似，是一个没有重复元素的字符串集合。不同之处是有序集合的每个成员都关联了一个评分（score）,这个评分（score）被用来按照从最低分到最高分的方式排序集合中的成员。集合的成员是唯一的，但是评分可以是重复了 。因为元素是有序的, 所以你也可以很快的根据评分（score）或者次序（position）来获取一个范围的元素。访问有序集合的中间元素也是非常快的,因此你能够使用有序集合作为一个没有重复成员的智能列表。</p><h3 id="_6-2-常用命令" tabindex="-1"><a class="header-anchor" href="#_6-2-常用命令"><span>6.2 常用命令</span></a></h3><table><thead><tr><th>语法</th><th>功能</th></tr></thead><tbody><tr><td>zadd &lt;key&gt;&lt;score1&gt;&lt;value1&gt;&lt;score2&gt;&lt;value2&gt;…</td><td>将一个或多个 member 元素及其 score 值加入到有序集 key 当中。</td></tr><tr><td>zrange&lt;key&gt;&lt;start&gt;&lt;stop&gt; [WITHSCORES]</td><td>升序返回有序集 key 中，下标在&lt;start&gt;&lt;stop&gt;之间的元素,0代表第一个元素索引,-1代表最后一个元素索引.带WITHSCORES，可以让分数一起和值返回到结果集。</td></tr><tr><td>zrevrange &lt;key&gt;&lt;start&gt;&lt;stop&gt; [WITHSCORES]</td><td>降序返回有序集 key 中，下标在&lt;start&gt;&lt;stop&gt;之间的元素,0代表第一个元素索引,-1代表最后一个元素索引.带WITHSCORES，可以让分数一起和值返回到结果集</td></tr><tr><td>zrangebyscore &lt;key&gt; &lt;min&gt; &lt;max&gt; [withscores] [limit offset count]</td><td>返回有序集 key 中，所有 score 值介于 min 和 max 之间(包括等于 min 或 max )的成员。有序集成员按 score 值递增(从小到大)次序排列。</td></tr><tr><td>zrevrangebyscore &lt;key&gt; &lt;max&gt; &lt;min&gt; [withscores] [limit offset count]</td><td>同上，改为从大到小排列。</td></tr><tr><td>zincrby &lt;key&gt;&lt;increment&gt;&lt;value&gt;</td><td>为元素的score加上增量</td></tr><tr><td>zrem &lt;key&gt;&lt;value&gt;</td><td>删除该集合下，指定值的元素</td></tr><tr><td>zcount &lt;key&gt;&lt;min&gt;&lt;max&gt;</td><td>统计该集合，分数区间内的元素个数</td></tr><tr><td>zrank &lt;key&gt;&lt;value&gt;</td><td>返回该值在集合中的排名，从0开始。</td></tr></tbody></table><p>案例：如何利用zset实现一个文章访问量的排行榜？</p><p><img src="/assets/r1_p0CpjaSfLZ-Bohaffk3.png" alt=""></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">和set一样，能保证元素不重复，但是它具有排序的功能。内部是通过一个score值来进行排序的。</span>
<span class="line"></span>
<span class="line">- ZADD key [NX|XX] [CH] [INCR] score member [score member ...]</span>
<span class="line">zadd exam 100 tom 90 lucy 80 kate</span>
<span class="line">(integer) 3</span>
<span class="line">- ZCARD key</span>
<span class="line">zcard exam</span>
<span class="line">(integer) 3</span>
<span class="line">- ZRANGE key start stop [WITHSCORES]</span>
<span class="line">zrange exam 0 -1</span>
<span class="line">1) &quot;kate&quot;</span>
<span class="line">2) &quot;lucy&quot;</span>
<span class="line">3) &quot;tom&quot;</span>
<span class="line">​</span>
<span class="line">zrange exam 0 -1 withscores</span>
<span class="line">1) &quot;kate&quot;</span>
<span class="line">2) &quot;80&quot;</span>
<span class="line">3) &quot;lucy&quot;</span>
<span class="line">4) &quot;90&quot;</span>
<span class="line">5) &quot;tom&quot;</span>
<span class="line">6) &quot;100&quot;</span>
<span class="line">​</span>
<span class="line">- ZREVRANGE key start stop [WITHSCORES]</span>
<span class="line">rev 是 reverse的简写 ， 表示相反</span>
<span class="line">zrevrange exam 0 -1 withscores</span>
<span class="line">1) &quot;tom&quot;</span>
<span class="line">2) &quot;100&quot;</span>
<span class="line">3) &quot;lucy&quot;</span>
<span class="line">4) &quot;90&quot;</span>
<span class="line">5) &quot;kate&quot;</span>
<span class="line">6) &quot;80&quot;</span>
<span class="line">- ZRANGEBYSCORE key min max [WITHSCORES]</span>
<span class="line"></span>
<span class="line">zrangebyscore exam (50  (100 withscores</span>
<span class="line"></span>
<span class="line">zrangebyscore exam (80 (90 </span>
<span class="line">(empty list or set)</span>
<span class="line">127.0.0.1:6379&gt; zrangebyscore exam (85 (95 </span>
<span class="line">1) &quot;lucy&quot;</span>
<span class="line">​</span>
<span class="line">也就是说是开区间，不包含两边的 (80,90)</span>
<span class="line">- ZREVRANGEBYSCORE key max min [WITHSCORES]</span>
<span class="line"></span>
<span class="line">zrevrangebyscore exam (85 (105 withscores</span>
<span class="line">(empty list or set)</span>
<span class="line">127.0.0.1:6379&gt; zrevrangebyscore exam (105 (5 withscores</span>
<span class="line">1) &quot;tom&quot;</span>
<span class="line">2) &quot;100&quot;</span>
<span class="line">3) &quot;lucy&quot;</span>
<span class="line">4) &quot;90&quot;</span>
<span class="line">5) &quot;kate&quot;</span>
<span class="line">6) &quot;80&quot;</span>
<span class="line">需要说明的是，rev 表示反过来显示，此时参数也应该反过来， max , min </span>
<span class="line"> </span>
<span class="line"></span>
<span class="line">ZRANGEBYLEX</span>
<span class="line">1) bylex 表示根据元素获取，而不是score</span>
<span class="line">2) zrangebylex exam [lucy [tom</span>
<span class="line">   1) &quot;lucy&quot;</span>
<span class="line">   2) &quot;tom&quot;</span>
<span class="line">获取 [lucy , tom]之间所有的元素 , []表示闭区间 , () 表示开区间</span>
<span class="line">3) zrangebylex exam - [tom</span>
<span class="line">获取 tom之前的所有元素，包括tom，因为是闭区间</span>
<span class="line">   zrangebylex exam - (tom</span>
<span class="line">获取 tom之前的所有元素，不包括tom，因为是开区间</span>
<span class="line">​</span>
<span class="line">​</span>
<span class="line">问题：</span>
<span class="line">127.0.0.1:6379[2]&gt; zrange zset01 0 -1 withscores</span>
<span class="line">1) &quot;lucy&quot;</span>
<span class="line">2) &quot;18&quot;</span>
<span class="line">3) &quot;lili&quot;</span>
<span class="line">4) &quot;19&quot;</span>
<span class="line">5) &quot;rose&quot;</span>
<span class="line">6) &quot;20&quot;</span>
<span class="line">7) &quot;kate&quot;</span>
<span class="line">8) &quot;21&quot;</span>
<span class="line">127.0.0.1:6379[2]&gt; zrangebylex zset01 [a [z </span>
<span class="line">1) &quot;lucy&quot;</span>
<span class="line">2) &quot;lili&quot;</span>
<span class="line">3) &quot;rose&quot;</span>
<span class="line">4) &quot;kate&quot;</span>
<span class="line">127.0.0.1:6379[2]&gt; zrangebylex zset01 [a [kate</span>
<span class="line">(empty list or set)</span>
<span class="line">127.0.0.1:6379[2]&gt; zrangebylex zset01 [a [k</span>
<span class="line">(empty list or set)</span>
<span class="line">127.0.0.1:6379[2]&gt; zrangebylex zset01 [a [l</span>
<span class="line">(empty list or set)</span>
<span class="line">127.0.0.1:6379[2]&gt; </span>
<span class="line">​</span>
<span class="line">​</span>
<span class="line">关于zrangebylex的说明：</span>
<span class="line">1) 如果score值不相等。那么通过zrangebylex得到的数据是无规律可循的</span>
<span class="line">2) 如果score值是相等的。那么就是按照日常的规律进行运行的</span>
<span class="line">zadd zs01 0 a 0 b 0 c 0 d 0 e 0 f 0 g</span>
<span class="line">zrangebylex zs01 - +  获取所有的数据 ， - 负无穷大 ， + 正无穷大</span>
<span class="line">zrangebylex zs01 - [f  获取所有的数据，截止到f，包括f</span>
<span class="line">zrangebylex zs01 (a (f  获取a-f的数据，不包括a和f</span>
<span class="line">ZSCORE key member</span>
<span class="line">获取lucy元素的score值</span>
<span class="line">zscore exam lucy</span>
<span class="line">&quot;90&quot;</span>
<span class="line">127.0.0.1:6379&gt; zscore exam hanmeimei</span>
<span class="line">(nil)</span>
<span class="line">ZINCRBY key number member</span>
<span class="line">将指定的元素（kate）的score加5分</span>
<span class="line">zincrby exam 5 kate</span>
<span class="line">&quot;85&quot;</span>
<span class="line">ZREM key member [member...]</span>
<span class="line">删除给定的元素，可以同时删除多个。如果找不到指定的值删除，则返回0。</span>
<span class="line">zrem exam hanmeimei</span>
<span class="line">(integer) 0</span>
<span class="line">zrem exam tom</span>
<span class="line">(integer) 1</span>
<span class="line">zrange exam 0 -1</span>
<span class="line">1) &quot;kate&quot;</span>
<span class="line">2) &quot;lucy&quot;</span>
<span class="line">------------------------------------------------ </span>
<span class="line"></span>
<span class="line">●ZADD key [NX|XX] [CH] [INCR] score member [score member ...]</span>
<span class="line">zadd exam 100 jim 90 tom 80 lucy 70 lili 60 kate</span>
<span class="line">必须先写score</span>
<span class="line">​</span>
<span class="line">●ZRANGE key start stop [WITHSCORES]</span>
<span class="line">zrange exam 0 -1</span>
<span class="line">zrange exam 0 -1 withscores</span>
<span class="line">​</span>
<span class="line">●ZREVRANGE key start stop [WITHSCORES]</span>
<span class="line">降序</span>
<span class="line">zrevrange exam 0 -1 withscores</span>
<span class="line">​</span>
<span class="line">​</span>
<span class="line">●ZRANGEBYSCORE key min max [WITHSCORES]</span>
<span class="line">●ZREVRANGEBYSCORE key min max [WITHSCORES]</span>
<span class="line">​</span>
<span class="line">​</span>
<span class="line">●ZCARD key</span>
<span class="line">●ZSCORE key member</span>
<span class="line">●ZINCRBY key increment member</span>
<span class="line">●ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</span>
<span class="line">    在分数的指定区间内返回数据</span>
<span class="line">    min参数可以通过 -inf 表示负无穷</span>
<span class="line">    max参数可以通过 +inf 表示正无穷</span>
<span class="line">​</span>
<span class="line">    默认是闭区间</span>
<span class="line">    可以通过 (min (max 形式指定开区间，例如：(50 (80</span>
<span class="line">●ZRANK key member</span>
<span class="line">    先对分数进行升序排序，返回member的排名。排名从0开始</span>
<span class="line">    zrank exam tom</span>
<span class="line">●ZREVRANK key member</span>
<span class="line">    zrevrank exam tom</span>
<span class="line">●ZREM key member [member ...]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-3-数据结构" tabindex="-1"><a class="header-anchor" href="#_6-3-数据结构"><span>6.3 数据结构</span></a></h3><p>SortedSet(zset)是Redis提供的一个非常特别的数据结构，一方面它等价于Java的数据结构Map&lt;String, Double&gt;，可以给每一个元素value赋予一个权重score，另一方面它又类似于TreeSet，内部的元素会按照权重score进行排序，可以得到每个元素的名次，还可以通过score的范围来获取元素的列表。</p><h2 id="第七节-其他应用类型" tabindex="-1"><a class="header-anchor" href="#第七节-其他应用类型"><span>第七节 其他应用类型</span></a></h2><h3 id="_7-1-geospatial" tabindex="-1"><a class="header-anchor" href="#_7-1-geospatial"><span>7.1 Geospatial</span></a></h3><blockquote><p>语法1: GEOADD key longitude latitude member [longitude latitude member ...]</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">192.168.109.100:6379&gt; GEOADD city 114.085947 22.547 shenzhen</span>
<span class="line">(integer) 1</span>
<span class="line">192.168.109.100:6379&gt; GEOADD city 113.280637 23.125178 guangzhou</span>
<span class="line">(integer) 1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Geo类型在Redis内部使用zset类型存储，所以可以使用zset命令进行常规操作</p><p>语法： ZRANGE city 0 -1 [withscores]</p></blockquote><blockquote><p>获取指定地区的坐标</p></blockquote><blockquote><p>语法2: GEOPOS city shenzhen</p></blockquote><blockquote><p>计算两地之间的直线距离</p></blockquote><blockquote><p>语法3：GEODIST key v1 v2 unit</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">GEODIST city guangzhou shenzhen km</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>单位：</p><p>m 表示单位为米[默认值]。</p><p>km 表示单位为千米。</p><p>mi 表示单位为英里。</p><p>ft 表示单位为英尺。</p><p>如果用户没有显式地指定单位参数， 那么 GEODIST 默认使用米作为单位。</p><blockquote><p>语法4: GEORADIUS key 经度 纬度 距离数字 单位</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">radius : 半径</span>
<span class="line">coordinate : 坐标</span>
<span class="line">GEORADIUS china:city 110 20 1000 km WITHCOORD WITHDIST</span>
<span class="line">1) 1) &quot;shenzhen&quot;</span>
<span class="line">   2) &quot;509.4622&quot;</span>
<span class="line">   3) 1) &quot;114.08594459295272827&quot;</span>
<span class="line">      2) &quot;22.54699993773966327&quot;</span>
<span class="line">2) 1) &quot;guangzhou&quot;</span>
<span class="line">   2) &quot;485.7406&quot;</span>
<span class="line">   3) 1) &quot;113.28063815832138062&quot;</span>
<span class="line">      2) &quot;23.12517743834835215&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>语法5： GEORADIUSBYMEMBER</p></blockquote><blockquote><p>在指定元素周围查找其他元素</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">GEORADIUSBYMEMBER china:city shenzhen 300 km WITHCOORD WITHDIST</span>
<span class="line">1) 1) &quot;shenzhen&quot;</span>
<span class="line">   2) &quot;0.0000&quot;</span>
<span class="line">   3) 1) &quot;114.08594459295272827&quot;</span>
<span class="line">      2) &quot;22.54699993773966327&quot;</span>
<span class="line">2) 1) &quot;guangzhou&quot;</span>
<span class="line">   2) &quot;104.6426&quot;</span>
<span class="line">   3) 1) &quot;113.28063815832138062&quot;</span>
<span class="line">      2) &quot;23.12517743834835215&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-hyperloglogs" tabindex="-1"><a class="header-anchor" href="#_7-2-hyperloglogs"><span>7.2 hyperloglogs</span></a></h3><blockquote><ol><li>添加</li></ol></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">PFADD user:access:1 tom jerry andy jim andy jerry tom</span>
<span class="line">(integer) 1</span>
<span class="line">PFADD user:access:2 andy jerry tom bob kate</span>
<span class="line">(integer) 1</span>
<span class="line">PFADD user:access:3 mary harry tom jerry</span>
<span class="line">(integer) 1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><ol start="2"><li>统计</li></ol></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">PFCOUNT user:access:1 user:access:2 user:access:3</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><ol start="3"><li>合并</li></ol></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">PFMERGE user:access:merge user:access:1 user:access:2 user:access:3</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_7-3-位图-bitmap" tabindex="-1"><a class="header-anchor" href="#_7-3-位图-bitmap"><span>7.3 位图(bitmap)</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">set k1 a</span>
<span class="line">取0位置的二进制值 : getbit a 0 </span>
<span class="line">设置1位置的二进制值为1：  setbit a 1 1</span>
<span class="line">位操作 op :  and ,  or</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>案例:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">set a a</span>
<span class="line">01100001 -&gt; &#39;a&#39;  -&gt; 97</span>
<span class="line">1+32+64 = 97</span>
<span class="line">127.0.0.1:6379&gt; getbit a 0</span>
<span class="line">(integer) 0</span>
<span class="line">127.0.0.1:6379&gt; getbit a 1</span>
<span class="line">(integer) 1</span>
<span class="line">127.0.0.1:6379&gt; getbit a 2</span>
<span class="line">(integer) 1</span>
<span class="line">127.0.0.1:6379&gt; getbit a 3</span>
<span class="line">(integer) 0</span>
<span class="line">127.0.0.1:6379&gt; getbit a 4</span>
<span class="line">(integer) 0</span>
<span class="line">127.0.0.1:6379&gt; getbit a 5</span>
<span class="line">(integer) 0</span>
<span class="line">127.0.0.1:6379&gt; getbit a 6</span>
<span class="line">(integer) 0</span>
<span class="line">127.0.0.1:6379&gt; getbit a 7</span>
<span class="line">(integer) 1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>案例：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line"># key=Mon的value的1001这个位置上的值设置为0</span>
<span class="line">setbit Mon 1001 0</span>
<span class="line"># key=Mon的value的1002这个位置上的值设置为1</span>
<span class="line">setbit Mon 1002 1</span>
<span class="line"># key=Mon的value的1003这个位置上的值设置为1</span>
<span class="line">setbit Mon 1003 1</span>
<span class="line">setbit Tue 1001 0</span>
<span class="line">setbit Tue 1002 0</span>
<span class="line">setbit Tue 1003 1</span>
<span class="line"></span>
<span class="line">setbit Wes 1001 0</span>
<span class="line">setbit Wes 1002 1</span>
<span class="line">setbit Wes 1003 1</span>
<span class="line"></span>
<span class="line">setbit Thu 1001 0</span>
<span class="line">setbit Thu 1002 0 </span>
<span class="line">setbit Thu 1003 0</span>
<span class="line"></span>
<span class="line">setbit Fri 1001 0</span>
<span class="line">setbit Fri 1002 1</span>
<span class="line">setbit Fri 1003 1</span>
<span class="line"></span>
<span class="line">setbit Sat 1001 0</span>
<span class="line">setbit Sat 1002 1</span>
<span class="line">setbit Sat 1003 0</span>
<span class="line"></span>
<span class="line">setbit Sun 1001 0</span>
<span class="line">setbit Sun 1002 1</span>
<span class="line">setbit Sun 1003 0</span>
<span class="line"></span>
<span class="line">          1001 1002 1003</span>
<span class="line"></span>
<span class="line">Mon         0   1   1</span>
<span class="line">Tue         0   0   1</span>
<span class="line">Wes         0   1   1</span>
<span class="line">Thu         0   0   0</span>
<span class="line">Fri         0   1   1</span>
<span class="line">Sat         0   1   0</span>
<span class="line">Sun         0   1   0</span>
<span class="line">------------------------------------</span>
<span class="line">op:OR       0   1   1</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"># OP 是 Operate 的简写，表示操作</span>
<span class="line">BITOP or result Mon Thu Wes Thu Fri Sat Sun</span>
<span class="line"></span>
<span class="line">GETBIT result 1001</span>
<span class="line">getbit result 1002</span>
<span class="line">getbit result 1003</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>or 表示或</p><p>and 表示与</p></blockquote><h1 id="第四章-jedis客户端程序" tabindex="-1"><a class="header-anchor" href="#第四章-jedis客户端程序"><span>第四章 Jedis客户端程序</span></a></h1><h2 id="学习目标-3" tabindex="-1"><a class="header-anchor" href="#学习目标-3"><span>学习目标</span></a></h2><p>1 了解Jedis</p><p>2 能够独立搭建Jedis的环境</p><p>3 熟练操作key操作相关API</p><p>4 熟练操作String操作相关API</p><p>5 熟练操作List操作相关API</p><p>6 熟练操作Set操作相关API</p><p>7 熟练操作Hash操作相关API</p><p>8 熟练操作Zset操作相关API</p><h2 id="第一节-jedis简介" tabindex="-1"><a class="header-anchor" href="#第一节-jedis简介"><span>第一节 Jedis简介</span></a></h2><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line"> Redis不仅是使用命令来操作，现在基本上主流的语言都有客户端支持，比如java、C、C#、C++、php、Node.js、Go等。在官方网站里列一些Java的客户端，有Jedis、Redisson、Jredis、JDBC-Redis、等其中官方推荐使用Jedis和Redisson。 在企业中用的最多的就是Jedis。Jedis提供了完整Redis命令，而Redisson有更多分布式的容器实现。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="第二节-环境准备" tabindex="-1"><a class="header-anchor" href="#第二节-环境准备"><span>第二节 环境准备</span></a></h2><blockquote><p>1 创建maven普通项目,导入如下依赖</p></blockquote><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.junit.jupiter/junit-jupiter-api --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.junit.jupiter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit-jupiter-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.8.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>2 虚拟机和Redis设置</p></blockquote><ul><li>禁用Linux的防火墙：Linux(CentOS7)里执行命令</li><li>systemctl stop/disable firewalld.service</li><li>redis.conf中注释掉bind 127.0.0.1 ,然后 protected-mode 的值设置为no</li></ul><blockquote><p>3 测试JAVA程序和Redis之间的通信</p></blockquote><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu<span class="token punctuation">.</span>jedis</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span></span><span class="token class-name">Jedis</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo01</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">TestPing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.6.101&quot;</span><span class="token punctuation">,</span><span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">String</span> pong <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;连接成功：&quot;</span><span class="token operator">+</span>pong<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="第三节-key相关api" tabindex="-1"><a class="header-anchor" href="#第三节-key相关api"><span>第三节 key相关API</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Test</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testKeyAPI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 添加 键值对并设置过期时间</span></span>
<span class="line">    jedis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span><span class="token string">&quot;k2&quot;</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">&quot;v2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;k3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 获取所有的键</span></span>
<span class="line">    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keys <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>keys<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> keys<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token comment">// 判断某个键是否存在</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 查看键剩余过期时间</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">ttl</span><span class="token punctuation">(</span><span class="token string">&quot;k2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 根据键获取值</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="第四节-string相关api" tabindex="-1"><a class="header-anchor" href="#第四节-string相关api"><span>第四节 String相关API</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 添加String</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 一次添加多个</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">mset</span><span class="token punctuation">(</span><span class="token string">&quot;ka&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;aaa&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;kb&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;bbb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//  获取</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 一次获取多个</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ka&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;kb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 追加</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;vvvvv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 获取长度</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 不存在时进行设置</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">setnx</span><span class="token punctuation">(</span><span class="token string">&quot;k1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;xxxxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">setnx</span><span class="token punctuation">(</span><span class="token string">&quot;k2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 增长/减少</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">&quot;k2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">decr</span><span class="token punctuation">(</span><span class="token string">&quot;k2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">incrBy</span><span class="token punctuation">(</span><span class="token string">&quot;k2&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">decrBy</span><span class="token punctuation">(</span><span class="token string">&quot;k2&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="第五节-list相关api" tabindex="-1"><a class="header-anchor" href="#第五节-list相关api"><span>第五节 List相关API</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 放入List</span></span>
<span class="line">        <span class="token class-name">Long</span> lpush <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">&quot;klist&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>lpush<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 获取List</span></span>
<span class="line">        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> kList <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">&quot;klist&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        kList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 取值</span></span>
<span class="line">        <span class="token class-name">String</span> klist <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">lpop</span><span class="token punctuation">(</span><span class="token string">&quot;klist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="第六节-set相关api" tabindex="-1"><a class="header-anchor" href="#第六节-set相关api"><span>第六节 Set相关API</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line">   <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 添加一个set集合</span></span>
<span class="line">        jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">&quot;skey&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;e&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 获取制定的set集合</span></span>
<span class="line">        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> skey <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">smembers</span><span class="token punctuation">(</span><span class="token string">&quot;skey&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        skey<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//判断是否包含</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">sismember</span><span class="token punctuation">(</span><span class="token string">&quot;skey&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//删除元素</span></span>
<span class="line">        jedis<span class="token punctuation">.</span><span class="token function">srem</span><span class="token punctuation">(</span><span class="token string">&quot;skey&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//弹出一个元素</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">spop</span><span class="token punctuation">(</span><span class="token string">&quot;skey&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//弹出N个元素</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">spop</span><span class="token punctuation">(</span><span class="token string">&quot;skey&quot;</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//从一个set向另一个set移动元素</span></span>
<span class="line">        jedis<span class="token punctuation">.</span><span class="token function">smove</span><span class="token punctuation">(</span><span class="token string">&quot;skey&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;bkey&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;X&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// ……</span></span>
<span class="line"></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="第七节-hash相关api" tabindex="-1"><a class="header-anchor" href="#第七节-hash相关api"><span>第七节 Hash相关API</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 添加值</span></span>
<span class="line">jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">&quot;player1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pname&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;宇智波赵四儿&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">&quot;player1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;14&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">&quot;player1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;gender&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;boy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 获取值</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">hget</span><span class="token punctuation">(</span><span class="token string">&quot;player1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;pname&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//  批量添加值</span></span>
<span class="line"><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> player2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">player2<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;pname&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;旋涡刘能&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">player2<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;13&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">player2<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;gender&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;boy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">jedis<span class="token punctuation">.</span><span class="token function">hmset</span><span class="token punctuation">(</span><span class="token string">&quot;player2&quot;</span><span class="token punctuation">,</span>player2<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 查看filed是否存在</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">hexists</span><span class="token punctuation">(</span><span class="token string">&quot;player1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pname&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 查看集合中所有的field</span></span>
<span class="line"><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> player1fields <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">hkeys</span><span class="token punctuation">(</span><span class="token string">&quot;player1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">player1fields<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 查看集合中所有的value</span></span>
<span class="line"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> player1vals <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">hvals</span><span class="token punctuation">(</span><span class="token string">&quot;player1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">player1vals<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 给制定属性+1</span></span>
<span class="line">jedis<span class="token punctuation">.</span><span class="token function">hincrBy</span><span class="token punctuation">(</span><span class="token string">&quot;player1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// 如不存在,添加某个属性</span></span>
<span class="line">jedis<span class="token punctuation">.</span><span class="token function">hsetnx</span><span class="token punctuation">(</span><span class="token string">&quot;player1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;height&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;156&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">hget</span><span class="token punctuation">(</span><span class="token string">&quot;player1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;page&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">hget</span><span class="token punctuation">(</span><span class="token string">&quot;player1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;height&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="第八节-zset相关api" tabindex="-1"><a class="header-anchor" href="#第八节-zset相关api"><span>第八节 ZSet相关API</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">// 准备数据</span></span>
<span class="line"><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span> <span class="token punctuation">,</span><span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> map<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span><span class="token number">11d</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;王五&quot;</span><span class="token punctuation">,</span><span class="token number">8d</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;赵六&quot;</span><span class="token punctuation">,</span><span class="token number">20d</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;刘七&quot;</span><span class="token punctuation">,</span><span class="token number">3d</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//  添加元素</span></span>
<span class="line">jedis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">&quot;zkey&quot;</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">jedis<span class="token punctuation">.</span><span class="token function">zadd</span><span class="token punctuation">(</span><span class="token string">&quot;zkey&quot;</span><span class="token punctuation">,</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token comment">// 升序返回有序</span></span>
<span class="line"> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> zkeys <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">zrange</span><span class="token punctuation">(</span><span class="token string">&quot;zkey&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> zkeys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token comment">//  降序返回元素</span></span>
<span class="line"> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> zkeys2 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">zrevrange</span><span class="token punctuation">(</span><span class="token string">&quot;zkey&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> zkeys2<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;===========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> zkeys3 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">zrangeByScore</span><span class="token punctuation">(</span><span class="token string">&quot;zkey&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> zkeys3<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;===========&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> zkeys4 <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">zrevrangeByScore</span><span class="token punctuation">(</span><span class="token string">&quot;zkey&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> zkeys4<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token comment">// 增加分数</span></span>
<span class="line"> jedis<span class="token punctuation">.</span><span class="token function">zincrby</span><span class="token punctuation">(</span><span class="token string">&quot;zkey&quot;</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> jedis<span class="token punctuation">.</span><span class="token function">zincrby</span><span class="token punctuation">(</span><span class="token string">&quot;zkey&quot;</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&quot;赵六&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token comment">//  删除 元素</span></span>
<span class="line"> jedis<span class="token punctuation">.</span><span class="token function">zrem</span><span class="token punctuation">(</span><span class="token string">&quot;zkey&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">zcount</span><span class="token punctuation">(</span><span class="token string">&quot;zkey&quot;</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">zrank</span><span class="token punctuation">(</span><span class="token string">&quot;zkey&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="第五章-springboot整合redis" tabindex="-1"><a class="header-anchor" href="#第五章-springboot整合redis"><span>第五章 SpringBoot整合Redis</span></a></h1><h2 id="_5-1-创建工程" tabindex="-1"><a class="header-anchor" href="#_5-1-创建工程"><span>5.1 创建工程</span></a></h2><p><img src="/assets/image-20230627195300172-C7WsXmnF.png" alt="image-20230627195300172"></p><h2 id="_5-2-添加依赖" tabindex="-1"><a class="header-anchor" href="#_5-2-添加依赖"><span>5.2 添加依赖</span></a></h2><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    </span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-3-创建配置文件" tabindex="-1"><a class="header-anchor" href="#_5-3-创建配置文件"><span>5.3 创建配置文件</span></a></h2><p>application.properties</p><div class="language-properties line-numbers-mode" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">spring.data.redis.host</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.6.131</span></span>
<span class="line"><span class="token comment">#如果默认端口号是6379，可以不配置</span></span>
<span class="line"><span class="token key attr-name">spring.data.redis.port</span><span class="token punctuation">=</span><span class="token value attr-value">6379</span></span>
<span class="line"><span class="token comment">#springboot默认使用lettuce访问redis。如果使用默认，则可以不配置</span></span>
<span class="line"><span class="token comment">#spring.data.redis.client-type=lettuce</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#设置lettuce的底层参数</span></span>
<span class="line"><span class="token comment">#spring.data.redis.lettuce.pool.enabled=true</span></span>
<span class="line"><span class="token comment">#spring.data.redis.lettuce.pool.max-active=8</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#切换jedis</span></span>
<span class="line"><span class="token key attr-name">spring.data.redis.client-type</span><span class="token punctuation">=</span><span class="token value attr-value">jedis</span></span>
<span class="line"><span class="token key attr-name">spring.data.redis.jedis.pool.enabled</span><span class="token punctuation">=</span><span class="token value attr-value">true</span></span>
<span class="line"><span class="token key attr-name">spring.data.redis.jedis.pool.max-active</span><span class="token punctuation">=</span><span class="token value attr-value">8</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>RedisTemplate、StringRedisTemplate： 操作redis的工具类</p><ul><li><p>要从redis的连接工厂获取链接才能操作redis</p></li><li><p><strong>Redis客户端</strong></p></li><li><ul><li>Lettuce： 默认</li><li>Jedis：可以使用以下切换</li></ul></li></ul><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token comment">&lt;!-- 依赖的排除 --&gt;</span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.lettuce<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lettuce-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">&lt;!--        切换 jedis 作为操作redis的底层客户端--&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-4-创建启动类" tabindex="-1"><a class="header-anchor" href="#_5-4-创建启动类"><span>5.4 创建启动类</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@SpringBootApplication</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-5-序列化定制" tabindex="-1"><a class="header-anchor" href="#_5-5-序列化定制"><span>5.5 序列化定制</span></a></h2><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Configuration</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppRedisConfiguration</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token doc-comment comment">/**</span>
<span class="line">     * 允许Object类型的key-value，都可以被转为json进行存储。</span>
<span class="line">     * <span class="token keyword">@param</span> <span class="token parameter">redisConnectionFactory</span> 自动配置好了连接工厂</span>
<span class="line">     * <span class="token keyword">@return</span></span>
<span class="line">     */</span></span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//把对象转为json字符串的序列化工具</span></span>
<span class="line">        template<span class="token punctuation">.</span><span class="token function">setDefaultSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> template<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-6-编写测试方法" tabindex="-1"><a class="header-anchor" href="#_5-6-编写测试方法"><span>5.6 编写测试方法</span></a></h2><p>创建测试类，编写测试方法</p><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token annotation punctuation">@Autowired</span></span>
<span class="line"><span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Test</span></span>
<span class="line"><span class="token keyword">void</span> <span class="token function">redisTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">//测试String</span></span>
<span class="line">    redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1234&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">//测试list集合</span></span>
<span class="line">    <span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;lucy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;mary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="第六章-redis配置文件解读" tabindex="-1"><a class="header-anchor" href="#第六章-redis配置文件解读"><span>第六章 Redis配置文件解读</span></a></h1><h2 id="学习目标-4" tabindex="-1"><a class="header-anchor" href="#学习目标-4"><span>学习目标</span></a></h2><p>1 了解网络相关的配置</p><p>2 了解GENERAL通用配置</p><p>3 了解SECURITY安全配置</p><p>4 了解LIMIT限制</p><h2 id="第一节-网络配置相关" tabindex="-1"><a class="header-anchor" href="#第一节-网络配置相关"><span>第一节 网络配置相关 </span></a></h2><h3 id="_1-bind绑定连接ip" tabindex="-1"><a class="header-anchor" href="#_1-bind绑定连接ip"><span>（1） bind绑定连接IP</span></a></h3><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">默认情况bind=127.0.0.1只能接受本机的访问请求,不写的情况下，无限制接受任何ip地址的访问,生产环境肯定要写你应用服务器的地址；服务器是需要远程访问的，所以需要将其注释掉.如果开启了protected-mode，那么在没有设定bind ip且没有设密码的情况下，Redis只允许接受本机的响应</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/assets/image-20230706115102403-D1XgzJqQ.png" alt="image-20230706115102403"></p><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">保存配置，停止服务，重启启动查看进程，不再限制是本机访问了。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/assets/image-20230706115212609-Dh8yEAD7.png" alt="image-20230706115212609"></p><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">这里完成之后,就可以在window上安装一个redis客户端,连接虚拟机上的redis服务了</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-端口号-6379" tabindex="-1"><a class="header-anchor" href="#_2-端口号-6379"><span>（2） 端口号： 6379</span></a></h3><p><img src="/assets/image-20230706115349569-CYf3h2tg.png" alt="image-20230706115349569"></p><h3 id="_3-tcp-backlog-连接队列" tabindex="-1"><a class="header-anchor" href="#_3-tcp-backlog-连接队列"><span>（3）tcp-backlog 连接队列</span></a></h3><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">  设置tcp的backlog，backlog其实是一个连接队列，backlog队列总和=未完成三次握手队列 + 已经完成三次握手队列。在高并发环境下你需要一个高backlog值来避免慢客户端连接问题。</span>
<span class="line"></span>
<span class="line">​  注意Linux内核会将这个值减小到/proc/sys/net/core/somaxconn的值（128），所以需要确认增大/proc/sys/net/core/somaxconn和/proc/sys/net/ipv4/tcp_max_syn_backlog（128）两个值来达到想要的效果</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/assets/image-20230706115554212-RFu-UElc.png" alt="image-20230706115554212"></p><h3 id="_4-timeout连接超时" tabindex="-1"><a class="header-anchor" href="#_4-timeout连接超时"><span>（4）timeout连接超时</span></a></h3><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">一个空闲的客户端维持多少秒会关闭，0表示关闭该功能。即永不关闭。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/assets/image-20230706115650664-DrfW16D6.png" alt="image-20230706115650664"></p><h3 id="_5-tcp-keepalive-连接心跳检测" tabindex="-1"><a class="header-anchor" href="#_5-tcp-keepalive-连接心跳检测"><span>（5）tcp-keepalive 连接心跳检测</span></a></h3><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">对访问客户端的一种心跳检测，每隔n秒检测一次。</span>
<span class="line">单位为秒，如果设置为0 则不会进行Keepalive检测，建议设置成60  </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/assets/image-20230706115754570-CwaJ1Fu3.png" alt="image-20230706115754570"></p><h2 id="第二节-genreal通用配置" tabindex="-1"><a class="header-anchor" href="#第二节-genreal通用配置"><span>第二节 GENREAL通用配置</span></a></h2><h3 id="_1-units单位" tabindex="-1"><a class="header-anchor" href="#_1-units单位"><span>（1）UNITS单位</span></a></h3><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line"> 配置大小单位,开头定义了一些基本的度量单位，只支持bytes，不支持bit,大小写不敏感</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/assets/image-20230706120047530-ntMcn7uq.png" alt="image-20230706120047530"></p><h3 id="_2-includes包含" tabindex="-1"><a class="header-anchor" href="#_2-includes包含"><span>（2）INCLUDES包含</span></a></h3><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">在当前配置文件中引入其他配置文件中的内容,一般都是引入一些公共配置</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/assets/image-20230706120131180-C8GwMsO9.png" alt="image-20230706120131180"></p><h3 id="_3-daemonize-后台进程" tabindex="-1"><a class="header-anchor" href="#_3-daemonize-后台进程"><span>（3）daemonize 后台进程</span></a></h3><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">是否为后台进程，设置为yes ,守护进程，后台启动</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/assets/image-20230706120319825-ZjGqHaVO.png" alt="image-20230706120319825"></p><h3 id="_4-pidfile-进程id文件" tabindex="-1"><a class="header-anchor" href="#_4-pidfile-进程id文件"><span>（4）pidfile 进程ID文件</span></a></h3><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">存放pid文件的位置，每个实例会产生一个不同的pid文件</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/assets/image-20230706120451425-DIC1u5ce.png" alt="image-20230706120451425"></p><h3 id="_5-databases-16" tabindex="-1"><a class="header-anchor" href="#_5-databases-16"><span>（5）databases 16 </span></a></h3><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">设定库的数量 默认16，默认数据库为0，可以使用SELECT &lt;dbid&gt;命令在连接上指定数据库id</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/assets/image-20230706120627340-DiJhmRGB.png" alt="image-20230706120627340"></p><h2 id="第三节-security安全配置" tabindex="-1"><a class="header-anchor" href="#第三节-security安全配置"><span>第三节 SECURITY安全配置</span></a></h2><blockquote><p>1 设置密码</p></blockquote><p><img src="/assets/image-20230706120811624-CUrqyfub.png" alt="image-20230706120811624"></p><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">访问密码的查看、设置和取消</span>
<span class="line">在命令中设置密码，只是临时的。重启redis服务器，密码就还原了。</span>
<span class="line">永久设置，需要再配置文件中进行设置。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/assets/image-20230706121200103-BJSrOAfY.png" alt="image-20230706121200103"></p><p><strong>重新连接客户端测试</strong></p><p><img src="/assets/image-20230706121253744-CcUqdC-4.png" alt="image-20230706121253744"></p><h2 id="第四节-limit限制" tabindex="-1"><a class="header-anchor" href="#第四节-limit限制"><span>第四节 LIMIT限制</span></a></h2><h3 id="_1-maxclients-客户端最大连接数" tabindex="-1"><a class="header-anchor" href="#_1-maxclients-客户端最大连接数"><span>（1）maxclients 客户端最大连接数</span></a></h3><ul><li>设置redis同时可以与多少个客户端进行连接。</li><li>默认情况下为10000个客户端。</li><li>如果达到了此限制，redis则会拒绝新的连接请求，并且向这些连接请求方发出“max number of clients reached”以作回应。</li></ul><p><img src="/assets/image-20230706121546036-yaTx7x8M.png" alt="image-20230706121546036"></p><h3 id="_2-maxmemory-最大占用内存" tabindex="-1"><a class="header-anchor" href="#_2-maxmemory-最大占用内存"><span>（2）maxmemory 最大占用内存</span></a></h3><ul><li>建议<strong>必须设置</strong>，否则，将内存占满，造成服务器宕机</li><li>设置redis可以使用的内存量。一旦到达内存使用上限，redis将会试图移除内部数据，移除规则可以通过maxmemory-policy来指定。</li><li>如果redis无法根据移除规则来移除内存中的数据，或者设置了“不允许移除”，那么redis则会针对那些需要申请内存的指令返回错误信息，比如SET、LPUSH等。</li><li>但是对于无内存申请的指令，仍然会正常响应，比如GET等。如果你的redis是主redis（说明你的redis有从redis），那么在设置内存使用上限时，需要在系统中留出一些内存空间给同步队列缓存，只有在你设置的是“不移除”的情况下，才不用考虑这个因素。</li></ul><p><img src="/assets/image-20230706121729584-C2JpQe87.png" alt="image-20230706121729584"></p><h3 id="_3-maxmemory-policy-置换策略" tabindex="-1"><a class="header-anchor" href="#_3-maxmemory-policy-置换策略"><span>（3）maxmemory-policy 置换策略</span></a></h3><ul><li>volatile-lru：使用LRU算法移除key，只对设置了过期时间的键；（最近最少使用）</li><li>allkeys-lru：在所有集合key中，使用LRU算法移除key</li><li>volatile-random：在过期集合中移除随机的key，只对设置了过期时间的键</li><li>allkeys-random：在所有集合key中，移除随机的key</li><li>volatile-ttl：移除那些TTL值最小的key，即那些最近要过期的key</li><li>noeviction：不进行移除。针对写操作，只是返回错误信息</li></ul><p><img src="/assets/image-20230706121843454-_CFblqcc.png" alt="image-20230706121843454"></p><h3 id="_4-maxmemory-samples" tabindex="-1"><a class="header-anchor" href="#_4-maxmemory-samples"><span>（4）maxmemory-samples</span></a></h3><ul><li>设置样本数量，LRU算法和最小TTL算法都并非是精确的算法，而是估算值，所以你可以设置样本的大小，redis默认会检查这么多个key并选择其中LRU的那个。</li><li>一般设置3到7的数字，数值越小样本越不准确，但性能消耗越小。</li></ul><p><img src="/assets/image-20230706122145032-DJW8nDVM.png" alt="image-20230706122145032"></p><ul><li>设置为 10，那么 Redis 将会增加额外的 CPU 开销以保证接近真正的 LRU 性能</li></ul><h1 id="第七章-redis事务锁机制及案例" tabindex="-1"><a class="header-anchor" href="#第七章-redis事务锁机制及案例"><span>第七章 Redis事务锁机制及案例</span></a></h1><h2 id="学习目标-5" tabindex="-1"><a class="header-anchor" href="#学习目标-5"><span>学习目标</span></a></h2><p>1 熟悉Redis事务的定义和特点</p><p>2 熟练Redis事务控制的相关命令</p><p>3 熟练使用Redis的锁对数据进行监视</p><p>4 熟练编写Redis调用LUA脚本代码</p><h2 id="第一节-redis事务和锁机制" tabindex="-1"><a class="header-anchor" href="#第一节-redis事务和锁机制"><span>第一节 Redis事务和锁机制</span></a></h2><h3 id="_1-1-redis事务的定义" tabindex="-1"><a class="header-anchor" href="#_1-1-redis事务的定义"><span>1.1 Redis事务的定义</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">  Redis事务是一个单独的隔离操作：事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。Redis事务的主要作用就是串联多个命令防止别的命令插队。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_1-2-redis事务控制命令" tabindex="-1"><a class="header-anchor" href="#_1-2-redis事务控制命令"><span>1.2 Redis事务控制命令</span></a></h3><table><thead><tr><th>命令</th><th>功能</th></tr></thead><tbody><tr><td>multi</td><td>开始组队</td></tr><tr><td>exec</td><td>执行队列中的命令</td></tr><tr><td>discard</td><td>取消组队</td></tr></tbody></table><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">从输入Multi命令开始，输入的命令都会依次进入命令队列中，但不会执行，直到输入Exec后，Redis会将之前的命令队列中的命令依次执行。组队的过程中可以通过discard取消组队</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/assets/%E5%9B%BE%E7%89%87_j3Vmrz98DG-BDp0pxuE.png" alt=""></p><blockquote><p>情况1 ,组队成功,提交成功</p></blockquote><p><img src="/assets/image-20230706135508396-8KutYl0w.png" alt="image-20230706135508396"></p><h3 id="_1-3-redis事务错误处理" tabindex="-1"><a class="header-anchor" href="#_1-3-redis事务错误处理"><span>1.3 Redis事务错误处理</span></a></h3><blockquote><p>情况2,组队报错,提交失败：提交失败组队中某个命令出现了报告错误，执行时整个的所有队列都会被取消</p></blockquote><p><img src="/assets/%E5%9B%BE%E7%89%87_RO0ZBPMI7z-B0dqSBZR.png" alt=""></p><p><img src="/assets/image-20230706135937567-BJkXsK-a.png" alt="image-20230706135937567"></p><blockquote><p>情况3, 组队成功,提交时有成功有失败。如果执行阶段某个命令报出了错误，则只有报错的命令不会被执行，其他的命令都会执行，不会回滚。</p></blockquote><p><img src="/assets/%E5%9B%BE%E7%89%87_34Jqqsr3Gw-DvkQ3YI_.png" alt=""></p><p><img src="/assets/image-20230706140338715-Bx2C3KyP.png" alt="image-20230706140338715"></p><h3 id="_1-4-redis事务场景案例" tabindex="-1"><a class="header-anchor" href="#_1-4-redis事务场景案例"><span>1.4 Redis事务场景案例</span></a></h3><blockquote><p>Redis采取的是乐观锁机制</p></blockquote><blockquote><p>场景说明</p></blockquote><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">想想一个场景：有很多人有你的账户,同时去参加双十一抢购  </span>
<span class="line">一个请求想给金额减8000</span>
<span class="line">一个请求想给金额减5000</span>
<span class="line">一个请求想给金额减1000</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/assets/%E5%9B%BE%E7%89%87_mhYf7Haj0b-DXgGqiBQ.png" alt=""></p><blockquote><p><strong>悲观锁</strong></p></blockquote><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">悲观锁(Pessimistic Lock), 顾名思义，就是很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁。传统的关系型数据库里边就用到了很多这种锁机制，比如行锁，表锁等，读锁，写锁等，都是在做操作之前先上锁。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/assets/%E5%9B%BE%E7%89%87_AZCbv_l8bV-RWsud014.png" alt=""></p><blockquote><p><strong>乐观锁</strong></p></blockquote><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">乐观锁(Optimistic Lock), 顾名思义，就是很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。乐观锁适用于多读的应用类型，这样可以提高吞吐量。Redis就是利用这种check-and-set机制实现事务的。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/assets/%E5%9B%BE%E7%89%87_dAWahkQ1CZ-D_X4MN12.png" alt=""></p><blockquote><p><strong>监视和取消监视key</strong></p></blockquote><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">在执行multi之前，先执行watch key1 [key2],可以监视一个(或多个) key ，如果在事务**执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断。**</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/assets/image-20230706141601678-C1A9rSo8.png" alt="image-20230706141601678"></p><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">取消 WATCH 命令对所有 key 的监视。如果在执行 WATCH 命令之后，EXEC 命令或DISCARD 命令先被执行了的话，那么就不需要再执行UNWATCH 了。 </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_1-5-redis事务的三个特性" tabindex="-1"><a class="header-anchor" href="#_1-5-redis事务的三个特性"><span>1.5 Redis事务的三个特性</span></a></h3><ul><li>单独的隔离操作 <ul><li>事务中的所有命令都会序列化、按顺序地执行。事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。</li></ul></li><li>没有隔离级别的概念 <ul><li>队列中的命令没有提交之前都不会实际被执行，因为事务提交前任何指令都不会被实际执行</li></ul></li><li>不保证原子性 <ul><li>事务中如果有一条命令执行失败，其后的命令仍然会被执行，没有回滚</li></ul></li></ul><h2 id="第二节-redis-lua-脚本" tabindex="-1"><a class="header-anchor" href="#第二节-redis-lua-脚本"><span>第二节 Redis Lua 脚本</span></a></h2><h3 id="_2-1-什么是lua" tabindex="-1"><a class="header-anchor" href="#_2-1-什么是lua"><span>2.1 什么是LUA</span></a></h3><blockquote><p>什么是LUA脚本</p></blockquote><p><img src="/assets/%E5%9B%BE%E7%89%87_g1e6OrgrfS-DAOTLb1g.png" alt=""></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Lua 是一个小巧的[脚本语言](http://baike.baidu.com/item/脚本语言)，Lua脚本可以很容易的被C/C++ 代码调用，也可以反过来调用C/C++的函数，Lua并没有提供强大的库，一个完整的Lua解释器不过200k，所以Lua不适合作为开发独立应用程序的语言，而是作为嵌入式脚本语言。很多应用程序、游戏使用LUA作为自己的嵌入式脚本语言，以此来实现可配置性、可扩展性。这其中包括魔兽争霸地图、魔兽世界、博德之门、愤怒的小鸟等众多游戏插件或外挂。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>LUA脚本的优势</p></blockquote><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">将复杂的或者多步的redis操作，写为一个脚本，一次提交给redis执行，减少反复连接redis的次数。提升性能。</span>
<span class="line">LUA脚本是类似redis事务，有一定的原子性，不会被其他命令插队，可以完成一些redis事务性的操作。但是注意redis的lua脚本功能，只有在Redis 2.6以上的版本才可以使用。利用lua脚本淘汰用户，解决超卖问题。redis 2.6版本以后，通过lua脚本解决争抢问题，实际上是redis利用其单线程的特性，用任务队列的方式解决多任务并发问题。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/assets/%E5%9B%BE%E7%89%87_XF01-BEOSG-CEgq4aXM.png" alt=""></p><h3 id="_2-2-创建springboot工程" tabindex="-1"><a class="header-anchor" href="#_2-2-创建springboot工程"><span>2.2 创建SpringBoot工程</span></a></h3><p><img src="/assets/image-20230706154943584-C3WN1j3R.png" alt="image-20230706154943584"></p><h3 id="_2-3-引入相关依赖" tabindex="-1"><a class="header-anchor" href="#_2-3-引入相关依赖"><span>2.3 引入相关依赖</span></a></h3><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml" data-title="xml"><pre><code><span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        </span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-4-创建配置文件" tabindex="-1"><a class="header-anchor" href="#_2-4-创建配置文件"><span>2.4 创建配置文件</span></a></h3><div class="language-properties line-numbers-mode" data-highlighter="prismjs" data-ext="properties" data-title="properties"><pre><code><span class="line"><span class="token key attr-name">spring.data.redis.host</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.6.131</span></span>
<span class="line"><span class="token key attr-name">spring.data.redis.port</span><span class="token punctuation">=</span><span class="token value attr-value">6379</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-5-创建lua脚本" tabindex="-1"><a class="header-anchor" href="#_2-5-创建lua脚本"><span>2.5 创建LUA脚本</span></a></h3><p>创建文件夹lua，创建脚本文件test.lua</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAABCCAIAAABilny8AAAGFElEQVR4nO3dP4jbVhwH8N9L2mvTaxpCIVBI6ZFEqjN46SYt5aAUJG64DrcVji7S0kUia6ashwQhi7yEgy7HDfFgJAiFI4u9tYNJ4kiXJi2dQkNpi/snIbwOkmX5z/lkn8/Ptr4fPJhnSe8Z7suTJb3fES+M9us3tx++3Gn+NuJ1++HL9us36S6+QWT42YN0WkJHIcMwKJFuNLK9e6TQUTofho4ysDX30yMojmOQ4oS9x/AHe+hpHX6sTKvfOWh83OR9tzU73u4IM4PJNCuGoWS+TP/X7N+m06o4T3o2H2OcS4Zxzqkwwj9e1X7966hvzBhtXD4vX1jJcaTIVeXWTe5pOduXRWCyW6WwbkmiB7JMzogewEzJF1Y2Lp9fOcMGP1o5w3InsFAiVzWD5H1g6hVlawMJnK63RA9g1uQLKx+/f/GHl//89Ofr31+9IaKLK2evfPD2Zx+eO3d2SDgLT7J2SypjOhERKQ5mwekr1ukowBwq1ukowBxCCAEEQwgBBEMIAQRDCAEEQwgBBBNwn/De/Qfp+/fefefTK5+sXf5o9sMAmBOCZ8K///3vx0fhk2e/iB0GgEACbtZnZ8LRvvry81MdCcA8mHAm3Nvbq9Vq7XY7bWm327VabW9vb0oDAyiKCUO4urrabrcPDg7iHKbvV1dXpzq8VOSqzAwCkzGmuhERUWCyRNIQb5TIPHPMWH9jfLD+93m6yNkpwBgmDOH6+nqawxcvXqQJXF9fn+74sip6dZNzXrekZEVNvBor3NqXzYAocrftcmcdWryWKDCZ3kyXoPmkH5eT3i66+9YtifJ2CjCeCa+OxnmLs3dwcJC2nGQmPPYXoOF3/sqDaoUaJDO785HSikgrlcnWWbP7oH9QrShOmD71r91wFLkaeNq1fF1k983fKcCYJr86mk3dyRMYC7/7ou915Ka9a6zrlkSkeZxzvkvb2bPF/t1KRyfweBN2CjDKiW5RxNm7dOnSVBJIRPLX3/e9hm+nbRoNe6f7s88MiChy3YCIJKseOkqjdZhstp0mI9ixKV2R2mxFRERRbb9xfBeB60Z5OwUY00lv1k/3d+Dg1HdEDjUvdFSZxYtwDZ97RCRZpZ3O4lPD5xoRaR73TZaeQRo+tyQikqxdZ1+WmZ3UPhkq20Xcg5SvU4DxzNF9QtwVhGKar5X1uWdCgOUxXyEEKKD5KvSEmRAKCDMhgGBYTwggGEIIIBhCCCAYQgggGEIIINh83aI41kT1aQKTVTexzgjm1QLPhKhPA8thwWbCQY+iZ4+iZ4PteBIVFoWAmRD1aQCyBIRw5vVpOoaXlkGVGBBMQAiF1Kc5WuTu0G5ShMao6IghzJqYmTCbwzSBpz4TDidZnkXxXKhXRAwAik7M1dHTqE8zochVGduO58LQOWKVPcApEnaLYur1afIZKC1z2Goozq4l0Yh6MwCnSeR9wlnPgZK165AtM8bYdqucTHrajU5bphFghhZsPSH+jwUsnwULIcDyWeDH1gCWA0IIIBhCCCAYQgggGEIIIBhCCCAYQggg2MIv6p3Y46fPr19d67v7j1v8MHsFnQkfP33eevrzDDsMTKxVhCMUMYQzTyDAKIUL4ZgJzK7AP71doNAK95vw+tW161fXRI8CoKtwM+G9+w+yr5HbBiaT7QZVdMZUN0paEklDb4Uaf8guvVDnBgYUbiaM3b3j9rV88601sJXm8bCkyq2bceXgwGS3SiHnEhFFriqbJe5dc7ftss/raWVhvWeXnJI6N1LciW6iVHGhFDSEwyJ3nKBaoQbJzO40KK2ItFKZbJ01nbBuSRMPR7I8K3JVZscr+42JDwSLqKAhzDcTDlAGsyZ5nHvx2WRjyMe5RK4q2+SEnEsUuarcGv8QsMAKGsJJZkJt09D1ncCKzxQD0yTP0yLXPbQsTbLqIaly65AoG8LIVeX9rf5kNlsRaVJc0qZMlNS5Cbt1bson+GaweAp3YSZ2946bvkZuKG1sKZ2rLJoXOk09uXxS3fQ0IpKsUjVukO2yHzelu4RDjoc6N9CvcOUtRl8RxWNrMHsFnQkB5gdCCCBY4U5HAeYNZkIAwf4HfyDl1uPo5H0AAAAASUVORK5CYII=" alt="image-20230706155329622"></p><blockquote><p>LUA脚本</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># lua中变量分为全局变量和本地变量</span></span>
<span class="line"><span class="token comment"># 使用local定义本地变量（局部变量）</span></span>
<span class="line"><span class="token comment"># call 执行、调用</span></span>
<span class="line"><span class="token comment"># KEYS表示将来要传入的KEYS数组，KEYS[1]表示获取数组中的第一个元素</span></span>
<span class="line"><span class="token comment"># ARGV。后面调用时，传入三个实参，其中第三个实参就是ARGV，表示其他参数</span></span>
<span class="line"><span class="token builtin class-name">local</span> current <span class="token operator">=</span> redis.call<span class="token punctuation">(</span><span class="token string">&#39;GET&#39;</span>, KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> current <span class="token operator">==</span> ARGV<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token keyword">then</span> redis.call<span class="token punctuation">(</span><span class="token string">&#39;SET&#39;</span>, KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>, ARGV<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token builtin class-name">return</span> <span class="token boolean">true</span>     <span class="token comment"># 表示当前lua脚本的返回值类型是boolean</span></span>
<span class="line">end</span>
<span class="line"><span class="token builtin class-name">return</span> <span class="token boolean">false</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># redisTemplate.execute(script, keyList, ARGV... );</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-6-创建配置类" tabindex="-1"><a class="header-anchor" href="#_2-6-创建配置类"><span>2.6 创建配置类</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ClassPathResource</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span><span class="token class-name">RedisConnectionFactory</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span>script<span class="token punctuation">.</span></span><span class="token class-name">RedisScript</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">GenericJackson2JsonRedisSerializer</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">StringRedisSerializer</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@Configuration</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppRedisConfiguration</span>  <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">//简单序列化</span></span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 设置键序列化方式</span></span>
<span class="line">        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 设置简单类型值的序列化方式</span></span>
<span class="line">        redisTemplate<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">// 设置默认序列化方式</span></span>
<span class="line">        redisTemplate<span class="token punctuation">.</span><span class="token function">setDefaultSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        redisTemplate<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">//加载lua脚本，设置返回值类型</span></span>
<span class="line">    <span class="token annotation punctuation">@Bean</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token class-name">RedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">script</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">Resource</span> scriptSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathResource</span><span class="token punctuation">(</span><span class="token string">&quot;lua/test.lua&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token class-name">RedisScript</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>scriptSource<span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token comment">//创建启动类，不需要启动，但是需要上面的注解：@SpringBootApplication</span></span>
<span class="line"><span class="token annotation punctuation">@SpringBootApplication</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyApplication</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MyApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-7-创建测试类" tabindex="-1"><a class="header-anchor" href="#_2-7-创建测试类"><span>2.7 创建测试类</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre><code><span class="line"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>atguigu</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span>script<span class="token punctuation">.</span></span><span class="token class-name">RedisScript</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collections</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token annotation punctuation">@SpringBootTest</span></span>
<span class="line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestLua</span> <span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">RedisScript</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> script<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Autowired</span></span>
<span class="line">    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token annotation punctuation">@Test</span></span>
<span class="line">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token function">checkAndSet</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;helloworld&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>flag <span class="token operator">?</span> <span class="token string">&quot;修改成功&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;修改失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment">// 手工添加一个值，再试试</span></span>
<span class="line">        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">boolean</span> flag1 <span class="token operator">=</span> <span class="token function">checkAndSet</span><span class="token punctuation">(</span><span class="token string">&quot;world&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>flag1 <span class="token operator">?</span> <span class="token string">&quot;修改成功&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;修改失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">checkAndSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> value1<span class="token punctuation">,</span><span class="token class-name">String</span> value2<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keyList <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>script<span class="token punctuation">,</span> keyList<span class="token punctuation">,</span> value1<span class="token punctuation">,</span>value2<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>RedisTemplate.execute说明</li></ul><p><img src="/assets/image-20230706160027980-6v0VZ_s2.png" alt="image-20230706160027980"></p><p><strong>RedisTemplate.execute需要传入三个值</strong></p><p><img src="/assets/image-20230706160201481-CnZv25Zq.png" alt="image-20230706160201481"></p><ul><li><strong>第一个参数 RedisScript script：</strong> Lua脚本</li></ul><ul><li>**第二个参数 List keys：**集合 <ul><li>如果是单个参数，使用这个可以转换为<strong>单元素集合</strong><ul><li>Collections.singletonList(参数)；</li></ul></li><li>多参数 <ul><li><code>List&lt;String&gt; keys = Arrays.asList(key1, key2, key3);</code></li></ul></li></ul></li><li>**第三个参数 args：**ARGV，也就是其他类型参数</li></ul><h1 id="第八章-redis的持久化" tabindex="-1"><a class="header-anchor" href="#第八章-redis的持久化"><span>第八章 Redis的持久化</span></a></h1><h2 id="学习目标-6" tabindex="-1"><a class="header-anchor" href="#学习目标-6"><span>学习目标</span></a></h2><p>1 熟悉Redis持久化的概念</p><p>2 熟悉RDB持久化方式特点以及相关操作</p><p>3 熟悉AOF持久化方式特点以及相关操作</p><h2 id="第一节-持久化总体介绍" tabindex="-1"><a class="header-anchor" href="#第一节-持久化总体介绍"><span>第一节 持久化总体介绍</span></a></h2><blockquote><p>我们知道Redis是一个内存型数据库,内存的特性是掉电或者程序退出则不保存数据,但是经过实测我们发现,Redis重启服务后,之前存储的数据仍然在,那么这就是通过持久化的方式实现的.</p></blockquote><p><img src="/assets/%E5%9B%BE%E7%89%87_EnqORY6CR7-CxJc9qBX.png" alt=""></p><blockquote><p>Redis 提供了2个不同形式的持久化方式。</p></blockquote><ul><li>RDB（Redis DataBase）定时数据快照 默认方式 存储的是数据</li><li>AOF（Append Of File） 指令日志文件 手动开启 存储的是指令</li></ul><h2 id="第二节-rdb持久化" tabindex="-1"><a class="header-anchor" href="#第二节-rdb持久化"><span>第二节 RDB持久化</span></a></h2><h3 id="_2-1-rdb简介" tabindex="-1"><a class="header-anchor" href="#_2-1-rdb简介"><span>2.1 RDB简介</span></a></h3><blockquote><p>在指定的时间间隔内将内存中的数据集快照写入磁盘,也就是行话讲的Snapshot快照，它恢复时是将快照文件直接读到内存里.</p></blockquote><p><img src="/assets/%E5%9B%BE%E7%89%87_8uzdIbhx32-DtWim2nj.png" alt=""></p><h3 id="_2-2-rdb持久化流程" tabindex="-1"><a class="header-anchor" href="#_2-2-rdb持久化流程"><span>2.2 RDB持久化流程</span></a></h3><blockquote><p>执行流程</p></blockquote><p> Redis会单独创建（fork）一个子进程来进行持久化，会先将数据写入到 一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。 整个过程中，主进程是不进行任何IO操作的，这就确保了极高的性能 如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。RDB的缺点是最后一次持久化后的数据可能丢失。</p><blockquote><p>Fork子进程</p></blockquote><ul><li>Fork的作用是复制一个与当前主进程一样的进程。新进程的所有数据（变量、环境变量、程序计数器等） 数值都和原进程一致，但是是一个全新的进程，并作为原进程的子进程</li><li>在Linux程序中，fork()会产生一个和父进程完全相同的子进程，但子进程在此后会exec系统调用，出于效率考虑，Linux中引入了“写时复制技术”</li><li>一般情况父进程和子进程会共用同一段物理内存，只有进程空间的各段的内容要发生变化时，才会将父进程的内容复制一份给子进程。</li></ul><blockquote><p>RDB持计划流程图</p></blockquote><p><img src="/assets/%E5%9B%BE%E7%89%87_4Cx4ku1M0s-CgGYPI45.png" alt=""></p><h3 id="_2-3-rdb相关配置与操作" tabindex="-1"><a class="header-anchor" href="#_2-3-rdb相关配置与操作"><span>2.3 RDB相关配置与操作</span></a></h3><blockquote><p>RDB文件名配置</p></blockquote><ul><li> 在redis.conf中配置文件名称，默认为dump.rdb</li></ul><p><img src="/assets/image-20230706162436439-CtZdW6wF.png" alt="image-20230706162436439"></p><blockquote><p>RDB文件位置配置</p></blockquote><ul><li>rdb文件的保存路径，也可以修改。默认为Redis启动时命令行所在的目录下.</li><li>可以通过修改该配置,将RDB文件存到系统的制定目录下dir &quot;/root/myredis/&quot;</li></ul><p><img src="/assets/image-20230706162540821-CP4-UYuK.png" alt="image-20230706162540821"></p><blockquote><p>RDB自动执行快照策略</p></blockquote><p><img src="/assets/image-20230706162725781-DCQ1fhC_.png" alt="image-20230706162725781"></p><ul><li>save命令临时执行快照执行策略 <ul><li><p>格式：save 秒钟 写操作次数 RDB是整个内存的压缩过的Snapshot，RDB的数据结构，可以配置复合的快照触发条件， 默认是1分钟至少1万个key发生变化，或5分钟至少100个key发生变化，或1个小时至少1个key发生变化。</p></li><li><p>禁用 不设置save指令，或者给save传入空字符串</p></li></ul></li></ul><blockquote><p>RDB手动执行快照命令</p></blockquote><ul><li><p>save VS bgsave</p><ul><li>save ：使用主进程进行持久化指令,save时只管保存，其它不管，全部阻塞。手动保存。不建议。</li><li>bgsave：Redis会在后台异步进行快照操作，快照同时还可以响应客户端请求。 可以通过lastsave 命令获取最后一次成功执行快照的时间 <img src="/assets/%E5%9B%BE%E7%89%87_AP4xT1NwRH-xwyvNOHA.png" alt=""></li></ul></li><li><p>flushall命令</p><ul><li>执行flushall命令，也会产生dump.rdb文件，但里面是空的，无意义</li></ul></li><li><p>shutdown命令</p><ul><li>shutdown命令在关系服务的时候也会进行自动的持久化</li></ul></li></ul><blockquote><p>RDB备份异常策略</p></blockquote><ul><li>stop-writes-on-bgsave-error 配置 <ul><li>当Redis无法写入磁盘的话，直接关掉Redis的写操作。推荐yes.</li></ul></li></ul><p><img src="/assets/image-20230706162910097-bKm_MMnF.png" alt="image-20230706162910097"></p><blockquote><p>RDB 文件压缩配置</p></blockquote><ul><li>rdbcompression配置 <ul><li>对于存储到磁盘中的快照，可以设置是否进行压缩存储。如果是的话，redis会采用LZF算法进行压缩。如果你不想消耗CPU来进行压缩的话，可以设置为关闭此功能。推荐yes. <img src="/assets/image-20230706163019916-C5T13UG5.png" alt="image-20230706163019916"></li></ul></li></ul><blockquote><p>RDB文件检查完整性配置</p></blockquote><ul><li>rdbchecksum配置 <ul><li>在存储快照后，还可以让redis使用CRC64算法来进行数据校验，但是这样做会增加大约10%的性能消耗，如果希望获取到最大的性能提升，可以关闭此功能.推荐yes.</li></ul></li></ul><p><img src="/assets/image-20230706163056568-Kbq3nFHV.png" alt="image-20230706163056568"></p><blockquote><p>RDB手动备份操作</p></blockquote><ul><li><p>查询rdb文件的目录 将 *.rdb的文件拷贝到别的地方</p></li><li><p>rdb的恢复</p><ul><li><p>关闭Redis</p></li><li><p>先把备份的文件拷贝到工作目录下 cp dump2.rdb dump.rdb</p></li><li><p>启动Redis, 备份数据会直接加载</p></li></ul></li></ul><blockquote><p>RDB禁用操作</p></blockquote><ul><li>修改配置文件永久禁用</li></ul><p><img src="/assets/%E5%9B%BE%E7%89%87_eoQ6gox1Ee-Bg_nooqi.png" alt=""></p><ul><li>通过指令临时禁用</li></ul><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">动态停止RDB：redis-cli config set save &quot;&quot;  save后给空值，表示禁用保存策略(不建议)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-4-rdb的优势和劣势" tabindex="-1"><a class="header-anchor" href="#_2-4-rdb的优势和劣势"><span>2.4 RDB的优势和劣势</span></a></h3><h4 id="_2-4-1-优势" tabindex="-1"><a class="header-anchor" href="#_2-4-1-优势"><span>2.4.1 优势</span></a></h4><ul><li>适合大规模的数据恢复</li><li>对数据完整性和一致性要求不高更适合使用</li><li><strong>节省磁盘空间</strong></li><li><strong>恢复速度快</strong></li></ul><p><img src="/assets/%E5%9B%BE%E7%89%87_EB6BePrSXM-D2nfx60w.png" alt=""></p><h4 id="_2-4-2-劣势" tabindex="-1"><a class="header-anchor" href="#_2-4-2-劣势"><span>2.4.2 劣势</span></a></h4><ul><li>Fork的时候，内存中的数据被克隆了一份，大致2倍的膨胀性需要考虑</li><li>虽然Redis在fork时使用了<strong>写时拷贝技术</strong>,但是如果数据庞大时还是比较消耗性能。</li><li>在备份周期在一定间隔时间做一次备份，所以如果Redis意外down掉的话，就会丢失最后一次快照后的所有修改。</li></ul><h3 id="_2-5-rdb小总结" tabindex="-1"><a class="header-anchor" href="#_2-5-rdb小总结"><span>2.5 RDB小总结</span></a></h3><p><img src="/assets/%E5%9B%BE%E7%89%87_qRi1oHbjWT-w8bu7fag.png" alt=""></p><h2 id="第三节-aof持久化" tabindex="-1"><a class="header-anchor" href="#第三节-aof持久化"><span>第三节 AOF持久化</span></a></h2><h3 id="_3-1-aof简介" tabindex="-1"><a class="header-anchor" href="#_3-1-aof简介"><span>3.1 AOF简介</span></a></h3><blockquote><p>RDB机制存储的是数据快照（数据本身）。AOF存储的是指令集合。</p></blockquote><p>Append Only File 以日志的形式来记录每个写操作（增量保存），将Redis执行过的所有写指令记录下来(读操作不记录)， 只许追加文件但不可以改写文件，redis启动之初会读取该文件重新构建数据，换言之，redis 重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作</p><h3 id="_3-2-aof持久化流程" tabindex="-1"><a class="header-anchor" href="#_3-2-aof持久化流程"><span>3.2 AOF持久化流程</span></a></h3><p>（1）客户端的请求写命令会被append追加到AOF缓冲区内；</p><p>（2）AOF缓冲区根据AOF持久化策略[always,everysec,no]将操作sync同步到磁盘的AOF文件中；</p><p>（3）AOF文件大小超过重写策略或手动重写时，会对AOF文件rewrite重写，压缩AOF文件容量；</p><p>（4）Redis服务重启时，会重新load加载AOF文件中的写操作达到数据恢复的目的；</p><p><img src="/assets/%E5%9B%BE%E7%89%87_9tVJtqcU_7-B8-eoAFC.png" alt=""></p><h3 id="_3-3-aof相关配置与操作" tabindex="-1"><a class="header-anchor" href="#_3-3-aof相关配置与操作"><span>3.3 AOF相关配置与操作</span></a></h3><blockquote><p>AOF文件名配置</p></blockquote><ul><li>可以在redis.conf中配置文件名称，默认为 appendonly.aof</li></ul><p><img src="/assets/image-20230706163701368-BVnSHyko.png" alt="image-20230706163701368"></p><blockquote><p>AOF文件位置路径</p></blockquote><ul><li>Redis6中，AOF文件的保存路径，同RDB的路径一致。</li><li>Redis7有变化：</li></ul><p>base：基本文件</p><p>incr：增量文件</p><p>manifest：清单文件</p><p><img src="/assets/image-20230706164947931-CVVJTiA5.png" alt="image-20230706164947931"></p><blockquote><p>AOF开启-修复-恢复操作</p></blockquote><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">AOF的备份机制和性能虽然和RDB不同, 但是备份和恢复的操作同RDB一样，都是拷贝备份文件，需要恢复时再拷贝到Redis工作目录下，启动系统即加载。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><p>正常恢复数据</p><ul><li><p>修改默认的appendonly no，改为yes,开启AOF方式</p><p><img src="/assets/image-20230706163851658-nnM_wUK9.png" alt="image-20230706163851658"></p></li><li><p>将有数据的aof文件复制一份保存到对应目录(查看目录：config get dir)</p></li><li><p>恢复：重启redis然后重新加载</p></li></ul></li><li><p>异常修复数据</p><ul><li><p>修改默认的appendonly no，改为yes</p></li><li><p>如遇到AOF文件损坏，通过/usr/local/bin/redis-check-aof --fix appendonly.aof.1.incr.aof进行恢复</p></li><li><p>备份被写坏的AOF文件</p></li><li><p>恢复：重启redis，然后重新加载</p></li></ul></li></ul><blockquote><p>AOF同步频率设置</p></blockquote><p><img src="/assets/image-20230706164003278-Dj63bxZT.png" alt="image-20230706164003278"></p><ul><li><p>appendfsync always</p><ul><li>始终同步，每次Redis的写入都会立刻记入日志；性能较差但数据完整性比较好</li></ul></li><li><p>appendfsync everysec</p><ul><li>每秒同步，每秒记入日志一次，如果宕机，本秒的数据可能丢失。</li></ul></li><li><p>appendfsync no</p><ul><li>redis不主动进行同步，把同步时机交给操作系统。</li></ul></li></ul><blockquote><p>AOF压缩配置</p></blockquote><ul><li><p>什么是文件压缩 rewrite重写?</p><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">AOF采用文件追加方式，文件会越来越大为避免出现此种情况，新增了重写机制, 当AOF文件的大小超过所设定的阈值时，Redis就会启动AOF文件的内容压缩， 只保留可以恢复数据的最小指令集.可以使用命令bgrewriteaof</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/assets/%E5%9B%BE%E7%89%87_9WJIX0nPEH-DDNPN5FS.png" alt=""></p></li><li><p>如何实现重写?</p><ul><li><p>AOF文件持续增长而过大时，会fork出一条新进程来将文件重写(也是先写临时文件最后再rename)，redis4.0版本后的重写，是将指令快照以二进制的形式附在新的aof头部，作为已有的历史数据，替换掉原来的流水账操作。</p></li><li><p>no-appendfsync-on-rewrite 设置重写策略</p></li><li><p>如果 no-appendfsync-on-rewrite=yes ,不写入aof文件只写入缓存，用户请求不会阻塞，但是在这段时间如果宕机会丢失这段时间的缓存数据。（降低数据安全性，提高性能）</p></li><li><p>如果 no-appendfsync-on-rewrite=no, 还是会把数据往磁盘里刷，但是遇到重写操作，可能会发生阻塞。（数据安全，但是性能降低）</p></li><li><p>重写到底是什么？</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">set num1 99</span>
<span class="line">incr num1</span>
<span class="line">incr num1</span>
<span class="line">----------</span>
<span class="line">set num1 101</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>何时触发重写?</p><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">Redis会记录上次重写时的AOF大小，默认配置是当AOF文件大小是上次rewrite后大小的一倍且文件大于64M时触发,重写虽然可以节约大量磁盘空间，减少恢复时间。但是每次重写还是有一定的负担的，因此设定Redis要满足一定条件才会进行重写。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>auto-aof-rewrite-percentage 设置重写基准值 <ul><li>文件达到100%时开始重写（文件是原来重写后文件的2倍时触发）</li></ul></li><li>auto-aof-rewrite-min-size 设置重写基准值 <ul><li>最小文件64MB。达到这个值开始重写。</li></ul></li></ul><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">例如：文件达到70MB开始重写，降到50MB，下次什么时候开始重写？100MB</span>
<span class="line">系统载入时或者上次重写完毕时，Redis会记录此时AOF大小，设为base_size,如果Redis的AOF当前大小&gt;= base_size +base_size*100% (默认)且当前大小&gt;=64mb(默认)的情况下，Redis会对AOF进行重写。 </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>重写的流程是?</p><ul><li>（1）bgrewriteaof触发重写，判断是否当前有bgsave或bgrewriteaof在运行，如果有，则等待该命令结束后再继续执行。</li><li>（2）主进程fork出子进程执行重写操作，保证主进程不会阻塞。</li><li>（3）子进程遍历redis内存中数据到临时文件，客户端的写请求同时写入aof_buf缓冲区和aof_rewrite_buf重写缓冲区,保证原AOF文件完整以及新AOF文件生成期间的新的数据修改动作不会丢失。</li><li>（4） <ul><li>1).子进程写完新的AOF文件后，向主进程发信号，父进程更新统计信息。 </li><li>2).主进程把aof_rewrite_buf中的数据写入到新的AOF文件。</li></ul></li><li>（5）使用新的AOF文件覆盖旧的AOF文件，完成AOF重写。</li></ul></li></ul><p><img src="/assets/%E5%9B%BE%E7%89%87_5xlibdltGu-DyGN-Jcl.png" alt=""></p><h3 id="_3-4-aof的优势" tabindex="-1"><a class="header-anchor" href="#_3-4-aof的优势"><span>3.4 AOF的优势</span></a></h3><p><img src="/assets/%E5%9B%BE%E7%89%87_HVeT9o0cSb-BMK0QpXl.png" alt=""></p><ul><li>备份机制更稳健，丢失数据概率更低。</li><li>可读的日志文本，通过操作AOF稳健，可以处理误操作。</li></ul><h3 id="_3-5-aof的劣势" tabindex="-1"><a class="header-anchor" href="#_3-5-aof的劣势"><span>3.5 AOF的劣势</span></a></h3><ul><li>比起RDB占用更多的磁盘空间。</li><li>恢复备份速度要慢。</li><li>每次读写都同步的话，有一定的性能压力。</li><li>存在个别Bug，造成无法恢复。</li></ul><h3 id="_3-6-aof小总结" tabindex="-1"><a class="header-anchor" href="#_3-6-aof小总结"><span>3.6 AOF小总结</span></a></h3><p><img src="/assets/%E5%9B%BE%E7%89%87_-ENRph4c9q-CnY8YN5-.png" alt=""></p><h3 id="_3-7-持久化方案选择" tabindex="-1"><a class="header-anchor" href="#_3-7-持久化方案选择"><span>3.7 持久化方案选择</span></a></h3><blockquote><p>RDB和AOP用哪个好?</p></blockquote><ul><li>官方推荐两个都启用。</li><li>如果对数据不敏感，可以选单独用RDB。</li><li>不建议单独用 AOF，因为可能会出现Bug。</li><li>如果只是做纯内存缓存，可以都不用。</li><li>AOF和RDB如果同时开启,系统默认取AOF中的持久化数据</li></ul><blockquote><p>官网建议</p></blockquote><p><img src="/assets/%E5%9B%BE%E7%89%87_DPRWQaWIxV-BMeX69U1.png" alt=""></p><ul><li>RDB持久化方式能够在指定的时间间隔能对你的数据进行快照存储</li><li>AOF持久化方式记录每次对服务器写的操作,当服务器重启的时候会重新执行这些命令来恢复原始的数据,AOF命令以redis协议追加保存每次写的操作到文件末尾.</li><li>Redis还能对AOF文件进行后台重写,使得AOF文件的体积不至于过大</li><li>只做缓存：如果你只希望你的数据在服务器运行的时候存在,你也可以不使用任何持久化方式.</li><li>同时开启两种持久化方式</li><li>在这种情况下,当redis重启的时候会优先载入AOF文件来恢复原始的数据, 因为在通常情况下AOF文件保存的数据集要比RDB文件保存的数据集要完整.</li><li>RDB的数据不实时，同时使用两者时服务器重启也只会找AOF文件。那要不要只使用AOF呢？</li><li>建议不要，因为RDB更适合用于备份数据库(AOF在不断变化不好备份)， 快速重启，而且不会有AOF可能潜在的bug，留着作为一个万一的手段。</li><li>性能建议</li></ul><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">因为RDB文件只用作后备用途，建议只在Slave上持久化RDB文件，而且只要15分钟备份一次就够了，只保留save 900 1这条规则。</span>
<span class="line"> </span>
<span class="line">如果使用AOF，好处是在最恶劣情况下也只会丢失不超过两秒数据，启动脚本较简单只load自己的AOF文件就可以了。</span>
<span class="line">代价,一是带来了持续的IO，二是AOF rewrite的最后将rewrite过程中产生的新数据写到新文件造成的阻塞几乎是不可避免的。</span>
<span class="line">只要硬盘许可，应该尽量减少AOF rewrite的频率，AOF重写的基础大小默认值64M太小了，可以设到5G以上。</span>
<span class="line">默认超过原大小100%大小时重写可以改到适当的数值。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="第九章-redis主从复制" tabindex="-1"><a class="header-anchor" href="#第九章-redis主从复制"><span>第九章 Redis主从复制</span></a></h1><h2 id="学习目标-7" tabindex="-1"><a class="header-anchor" href="#学习目标-7"><span>学习目标</span></a></h2><p>1 熟悉Redis主从复制的特点</p><p>2 能搭建Redis的 一主二仆和哨兵模式</p><h2 id="第一节-什么是主从复制" tabindex="-1"><a class="header-anchor" href="#第一节-什么是主从复制"><span>第一节 什么是主从复制</span></a></h2><blockquote><p>主机数据更新后根据配置和策略， 自动同步到备机的master/slaver机制，Master以写为主，Slave以读为主</p></blockquote><h2 id="第二节-主从复制的作用" tabindex="-1"><a class="header-anchor" href="#第二节-主从复制的作用"><span>第二节 主从复制的作用</span></a></h2><ul><li>读写分离，性能扩展</li><li>容灾快速恢复</li></ul><p><img src="/assets/%E5%9B%BE%E7%89%87_ouTt3xfpGK-BkLviZe1.png" alt=""></p><h2 id="第三节-主从复制具体操作" tabindex="-1"><a class="header-anchor" href="#第三节-主从复制具体操作"><span>第三节 主从复制具体操作</span></a></h2><h3 id="_1-实现思路" tabindex="-1"><a class="header-anchor" href="#_1-实现思路"><span>（1）实现思路</span></a></h3><ul><li><p>1 一个redis服务作为主机,主要负责写操作</p></li><li><p>2 两个redis服务作为从机,主要负责读操作</p></li><li><p>3 从机自动从主机同步数据下来</p></li><li><p>4 从机主动找主机,而主机不会找从机</p></li><li><p>5 正常来说主机和从机应该在不同的IP上开启redis服务,我们为了快速模拟,可以在一台机器上模拟出三个redis服务即可</p></li></ul><h3 id="_2-一台机器上启动多个redis服务" tabindex="-1"><a class="header-anchor" href="#_2-一台机器上启动多个redis服务"><span>（2） 一台机器上启动多个redis服务</span></a></h3><ul><li>使用redis-server启动服务时,要以来redis.conf配置文件.那么我们可以准备三个redis.conf文件,用来配置三个不同的服务,启动三次分别以来三个不同的服务即可</li></ul><h3 id="_3-新建三个redis配置文件" tabindex="-1"><a class="header-anchor" href="#_3-新建三个redis配置文件"><span>（3）新建三个redis配置文件</span></a></h3><p><strong>用于定义每个服务的专属配置</strong></p><p>关闭aof功能</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXMAAABQCAIAAABklwLpAAAL4UlEQVR4nO3dPW/aahsH8ItH5wMYf4G6vHSIMrgRE55ALNClslDWLgiPsHTLmK0LHoOyZEXI6tKwRHgKEyIeogwHQ3ykM9v+AEfyMxio8QuBxCEm/f+2hsu37SpcuV/s+0r9+++/dJj++++/neI/fPjwSlcCkEy6LOTbI+9Pip3pbSu3h1OnkFkAIHb/e+sLAIB3CJkFAOKHzAIA8UNmAYD4IbMAQPyQWQAgfn+F/9i2DeNuMp+ZVGiI/Ibjbdu4G05mpklERGy2UC7xzHqIoV7ezCIOz1YaJS7QpqENJ+NVk5VyiWMCRwJAgvkzi60pwzmlM5mP3OcyWf35hmNtTemPTTZbKTc4htyMcNO/tHzZgkuzlD0JZhBDvbwJb3SeXjZJtqEN+4pdF/35CgASzD8aYnhRFMUSz3PMU19l425ssoW6uOpRMBwv1gvsbKLZa4G8GNIxIeNxRtmPvp/b2nBMBU8nheH4coHGQ1+TAJBoL5hn4UqNRqArwTBpMq0t0kB4YjHmJpvxtclwGdacG0gtAIcj7hlc27a2iwtLLADwTsSaWWxDHY7NbCVk7ONj3IUmFrd74h/52JbJZjCJC3BAItaGdvN79YctVBr80z0R27aIzYTEMbxYsZShxpX55TyPoU6oUsYELsAhiSWzcKVGo0S2od1NxhOVmMDCs58xN9lMOaKxzyePw/5wzpqmybKsaVKhXkJeATgosWQWF8PxJY7TlH5fZcIWg1ZsbW6ymXJotrA1pT/P1Bu/c4mtKX3FqohPD7EAICninsFl+JMszSbahhB3ASh83sS4G5vZ9aEPw59kzdmjEe91AsBriv/pfibNbg7YkFhs2yI27f+I+5glpBaAQxJ/ZrEtc+PnhmVSesNjeIHEQkQUkm8AILmen1k05VIJPhlra5MZZU+iXzUyHmeU/RwxZ8JwGday/Y3atkVprDoDHJDnZxa+XKBx/1JRjWUqsA1V6Y9p4/Ms7qO3kVmC4cuZ+VDRVtnFtg11OE9XsDoEcEgCO2xveDM55MVkd6V5thj/sGzhpMxv7F1oyqUV8nair1F1eLNqM/JdZ+ywDZBY2LsfAOKHnZ8AIH7ILAAQP2QWAIhfjE/3J8sHDm8DwB45zltfQbKgzwIA8UNmAYD4IbMAQPyQWQAgfu92BtfnH8PAk3IQp1Tqra8g0dBnAYD4IbMAQPySWH2VbE0dLl9zDG0SNtNlId8eEVGx49y2XvlkAylV667+1bx2LqqvfEY4AImrvuq2StlKXeSYRYpT1I/YBncXudat09JlId/bw8mqF45zQURujtnDCeEQ+DMLw4urPsoTVQmX1Vd5T6VUsU5Kf6J95ry9DF5shB3+OKNsJZAvtOHY9PRkGIbjS5ymqAaH3AJwMJJVfdXd1r8Q2HKOy1j+YtEAkGAJq75qh2+SyzBpcx7bFtu6PpAlSRBSC4IgD/S1AHnxmSDrpOuytApNCYLkjd0+0nuMJyqVEiQ5EDeQ3M+kAdHAEx7VpP/Ukhwe5jYue+49JUjy4KVn34LsOePaxS1PFvjgac+4zifvHeKSrOqrxKRZCm6ES7ZtkWnFk1oGUj5f69HR2dXUcRzHcaZnx+1aXvL8juVat47jdIpE9EvK53t0Nl3EOldndJ4XVsHbR67OLuTb98fXq7Dp2VGv5o+rXjjOdZPo/lxInT8cLa50en18v36hLl0W8t8ejs6cVZPUy6eEXw/Bm9dlIXX+8PXqdhnr3H6lc993erezb6d161w3iZrXjnPbyvlONnU/Wf/gaTte51b3DnHZtKecW1Vs89oQEfmqr4rbVF+NbNnWlP44vT4HbBvqcGKZlKmvDb427ynne9d585NyAylVu/cvo8hCqj2iYmfq/43XZSH/cOZZAtk60j1PIMyd+vQtqgykVK3rb1OXhXz7eC1Sl1J5/7FE+kDK17q+taGw04Te0PZnf/I2fKfpnUbc/dS52C2v7HidO9z7lnxPyuFd53Wx9Fm4UqPRaNQrhSyNJ+oWEyJuyaGwTxj+pMDObhTVsImIbENTleHk40kmjuuMVP3apNFDyJ/jYucq+Ic01zprds99f+q2iNTl8y41Q8Ko+r1TDLRIRM0zX3Du0zHR/d+/A3X5W7fYCX4vctWLTnH9R7p83i12vod8hUJvaJuz7ybXOmuO2j/8/83uZT0nrSxscZ073zu8VIyjIYbjS2I9Y4376uZxi1t9NWojbo4X65W0ddO/vLy87E+sdLkscvREEaPXcvwp9Dc+f1Qc9X7tGjl9GFHza2hY7stpcdT7tfvv9/RhVDz9EvrRl9O11KL/6o2KpxEDjurR806/o+r3TrH7cy21DKT2KJAa4paEe//TJKz66qIRriQ2XGKJZxh3XnhT+bOdrE/jpVIpQTjvhkYWj/JbtrltZLeWCuU+2La7v++fddhbybVO1ztng59dan7Fo3XvT7Kqr0axLTN0wnd3uiykaj06/T3T6jjO1dVpMzR69DDdst1tI5vXTqRdZzCJiD4d73zI21obEUUPUuDQJa/6akiL2iR8JWlnuvytPWpe3160qjnPtziX+xRxQMSkQsgYZIvI6tcmdX/G2+0OGZct/eqtdYPcAVfEhMLgYVQ8/fK6Q5KF6sVqTmnwYw8jIaLk3PufJFnVV0PYhtofU6Ee2xO4xaPAn0hdjhgN0aj9Lfj7qMvn3cAXYpvI6kWn2A0JI7cv9Zz1z1zrqjlqh6xEDyT/+CpiApWIBlIteEOvZ3Ed+h5HQom59z9Hwqqvkm0YtucfqtKfUKEeeNT3mXJfToujtufBOH0gS0Iq36NiaHyxc33aywvSQP99gCTke8fX/tWYLSNbt9fHvbwgyZ44fSBLQr4dXOLY8p4upp37mvehL30gCfnafafpv6nqMlT3LC4NJKF235nu8zVCdyns23noqtZrnTMh9/7HSFr1VUNTbsaLt5zZbObkM8dFjZye+TyLLkvf2t3l3/Nis3P2vVWdLt/X9byqKwup3un0tkUD6dt5d+QeUSw2z64uquspYPtI10CWznvLOCoWm6dn31ueyNWryrR2Sd6Xin0vMeu6/OP3XRWbnavvLfq1euF57XEP39mbnbOLlvertdPZ11909ot+8XkgpWrdl70Xvfv/0tP3vgs8z7LRu62+utOTcqGW+eLpjsT2kbDwkqfjEgKZZaM/ZbdKSBJ3TWh6wGkFnoLMAns3+NEeNa9vkVjeM2QW2LfBz26xM8Ws6fuGfXBDuHsjtEc0auc3v+C/feQfzrNZQqrWXfx34f/qHcMMLsCzYAZ3I/RZACB+yCwAED9kFgCIHzILAMTvT1l19k3oAsCrQp8FAOK3h+qry0hDG07Gq8BKuRT96qKn/CqqrwIcoD1UX12GztPLQLINbdhX7PDdEQz18oYq9UbJbVMd9hWKbR8FANgH/2iI4UVRFEs8H7l5wcqy+uqq78FwvFgvsLNAOUNbG46p4OmkMBxfLtB4GLLNv6HezLIVT5slsZIOjQSAxHrBDC5XagTrNa+qr3rykrultrieqRguw47nhs2vdUZsbTJjC/X1Lg/3OXvTvzP4nbaV+8fwFxDAM7gAe/NW1VcjjjbmJpsJDHyYj1maPcZWfRUAXts+qq8yXIY154EhkhW+hX86YhS2TRl6AEiGWJ5nWau+2ghWX2V4sWIpQ40r88vZG0OdUKUcNi0blkGYNEsv6QsBwH7Fklm4UqNRWuyJO1GJCVkl5j6fPA77wzlrmibLsqZJhXoJyz0A71SMz+AyHF/iOE3p91XGt+7sVohfLCSvfqJYFTG2Yh8AkCB7qb5q3I3N7PrQh+FPsubWs7JPVUcDgGTZR/VV27aIDUzMchELPmbEVG3UzC4AJM++qq+G5wV/vmG4DEuW4U8tbvkzjJsADsY+qq8yXIa1bH+obVuU9q86M/xJ1pz7UovxOGMLOxRsBYC3tpfqqwxfzsyHirbKLrZtqMN5uhKyOsSVKulxXzVWbWrKjVUIXZ8GgKTaX/VV21CHN6vIje86e0Oj33XevMN2EJ7uB9ibd7t3fxAyC8DeYOcnAIgfMgsAxO//4tdsSvsVFkcAAAAASUVORK5CYII=" alt="image-20230706184344365"></p><ol><li>新建redis6379.conf</li></ol><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line"># 引入或包含 redis.conf配置</span>
<span class="line">include /root/myredis/redis.conf</span>
<span class="line"># 指定进程文件名</span>
<span class="line">pidfile /var/run/redis_6379.pid</span>
<span class="line"># 设定端口号</span>
<span class="line">port 6379</span>
<span class="line"># 指定rdb文件名</span>
<span class="line">dbfilename dump6379.rdb</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/assets/%E5%9B%BE%E7%89%87_3F9OYl-6g2-oGPx2GEq.png" alt=""></p><p>含义介绍</p><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">include /root/myredis/redis.conf # 引入共同的配置</span>
<span class="line">pidfile /var/run/redis_6379.pid # 使用独立的进程文件</span>
<span class="line">port 6379 # 设置当前服务的端口号</span>
<span class="line">dbfilename dump6379.rdb # 使用独立的RDB持久化文件  暂时不使用AOP持久化</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>新建redis6380.conf</p><p><img src="/assets/%E5%9B%BE%E7%89%87_oDvKOz3DIQ-C4zUsnaq.png" alt=""></p><p>新建redis6381.conf</p><p><img src="/assets/%E5%9B%BE%E7%89%87_9MBKy-BD_t-DOUgA13v.png" alt=""></p><p>在redis6381中多添加一个配置,设置从机的优先级，值越小，优先级越高，用于选举主机时使用。默认100</p><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">replica-priority 10 </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_4-启动三个服务" tabindex="-1"><a class="header-anchor" href="#_4-启动三个服务"><span>（4）启动三个服务</span></a></h3><p><img src="/assets/image-20230706185404340-BKQfu1H-.png" alt="image-20230706185404340"></p><h3 id="_5-查看启动服务进程" tabindex="-1"><a class="header-anchor" href="#_5-查看启动服务进程"><span>（5）查看启动服务进程</span></a></h3><p><img src="/assets/image-20230706185335546-D9SFX-5I.png" alt="image-20230706185335546"></p><h3 id="_6-使用info-replication查看主从相关信息" tabindex="-1"><a class="header-anchor" href="#_6-使用info-replication查看主从相关信息"><span>（6）使用info replication查看主从相关信息</span></a></h3><ul><li>连接redis，使用：redis-cli -p 端口号</li><li>执行 info replication查看信息</li></ul><p><img src="/assets/image-20230706185249563-ClrSjObY.png" alt="image-20230706185249563"></p><h3 id="_7-配置主从机器" tabindex="-1"><a class="header-anchor" href="#_7-配置主从机器"><span>（7） 配置主从机器</span></a></h3><ul><li><p>配从不配主,是让从机主动去找主机</p></li><li><p>在6380 和6381的机器上执行如下命令</p><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">slaveof 127.0.0.1 6379</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>执行完毕再次查看主从配置信息</p><p><img src="/assets/image-20230706185658801-CqljeQe1.png" alt="image-20230706185658801"></p></li></ul><h3 id="_8-测试主从读写操作" tabindex="-1"><a class="header-anchor" href="#_8-测试主从读写操作"><span>（8）测试主从读写操作</span></a></h3><ul><li><p>主机上写入数据OK</p></li><li><p>在从机上写数据报错</p><p><img src="/assets/%E5%9B%BE%E7%89%87_GQz6WElSh0-D3jOkDcQ.png" alt=""></p></li><li><p>主机宕机,重启即可恢复主从状态,无需其他操作</p></li><li><p>从机宕机,重启后需要重新执行 slaveof 127.0.0.1 6379 才能恢复</p></li><li><p>从机可以在配置文件中写入slaveof 127.0.0.1 6379 ,这样重启无需手动输入slaveof 127.0.0.1 6379就可以恢复从机状态</p></li></ul><h2 id="第四节-主从复制原理" tabindex="-1"><a class="header-anchor" href="#第四节-主从复制原理"><span>第四节 主从复制原理</span></a></h2><ul><li>Slave启动成功连接到master后会发送一个sync命令,要求数据同步</li><li>Master接到命令启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令， 在后台进程执行完毕之后，master将传送整个数据文件到slave,以完成一次完全同步</li><li>全量复制：而slave服务在接收到数据库文件数据后，将其存盘并加载到内存中。</li><li>增量复制：Master继续将新的所有收集到的修改命令依次传给slave,完成同步</li><li>但是只要是重新连接master,一次完全同步（全量复制)将被自动执行</li></ul><p><img src="/assets/%E5%9B%BE%E7%89%87_ARh2hxM4BZ-Bkdsfytz.png" alt=""></p><h2 id="第五节-主从复制三种模式" tabindex="-1"><a class="header-anchor" href="#第五节-主从复制三种模式"><span>第五节 主从复制三种模式</span></a></h2><blockquote><p>第一种 一主二仆</p></blockquote><ul><li>问题1: 切入点问题,slave1、slave2是从头开始复制还是从切入点开始复制?比如从k4进来，那之前的k1,k2,k3是否也可以复制？</li><li>问题2 :从机是否可以写？set可否？</li><li>问题3:主机shutdown后情况如何？从机是上位还是原地待命？</li><li>问题4:主机又回来了后，主机新增记录，从机还能否顺利复制？</li><li>问题5:其中一台从机down后情况如何？依照原有它能跟上大部队吗(还会自动变为从机吗?)？</li></ul><p><img src="/assets/%E5%9B%BE%E7%89%87_r1ItTkr3yQ-BWb-rjRb.png" alt=""></p><blockquote><p>第二种 薪火相传</p></blockquote><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">上一个Slave可以是下一个slave的Master，Slave同样可以接收其他 slaves的连接和同步请求，那么该slave作为了链条中下一个的master, 可以有效减轻master的写压力,去中心化降低风险。用 slaveof  &lt;ip&gt;&lt;port&gt;</span>
<span class="line">​中途变更转向:会清除之前的数据，重新建立拷贝最新的,风险是一旦某个slave宕机，后面的slave都没法备份,主机挂了，从机还是从机，无法写数据了</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/assets/%E5%9B%BE%E7%89%87_Ph7uZJfPCr-D03cWCm0.png" alt=""></p><blockquote><p>第三种 反客为主</p></blockquote><ul><li>当一个master宕机后，后面的slave可以立刻升为master，其后面的slave不用做任何修改。用 slaveof no one 将从机变为主机。</li></ul><p><img src="/assets/%E5%9B%BE%E7%89%87_b9dFKRgmDO-CVuqX1TG.png" alt=""></p><h2 id="第六节-哨兵模式" tabindex="-1"><a class="header-anchor" href="#第六节-哨兵模式"><span>第六节 哨兵模式</span></a></h2><h3 id="_6-1-哨兵模式简介" tabindex="-1"><a class="header-anchor" href="#_6-1-哨兵模式简介"><span>6.1 哨兵模式简介</span></a></h3><blockquote><p>反客为主的自动版，能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库</p></blockquote><h3 id="_6-2-哨兵模式的使用步骤" tabindex="-1"><a class="header-anchor" href="#_6-2-哨兵模式的使用步骤"><span>6.2 哨兵模式的使用步骤</span></a></h3><h4 id="_1-第一步-设置简单的一主二仆" tabindex="-1"><a class="header-anchor" href="#_1-第一步-设置简单的一主二仆"><span>（1）第一步: 设置简单的一主二仆</span></a></h4><p><img src="/assets/%E5%9B%BE%E7%89%87_P-N3sLBZXe-DockY5wN.png" alt=""></p><h4 id="_2-第二步-为哨兵模式准备配置文件" tabindex="-1"><a class="header-anchor" href="#_2-第二步-为哨兵模式准备配置文件"><span>（2）第二步: 为哨兵模式准备配置文件</span></a></h4><ul><li><p>在/root/myredis 目录下新建sentinel.conf 配置文件中放入如下内容</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">sentinel monitor mymaster 127.0.0.1 6379 1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>其中mymaster为监控对象起的服务器名称， 1 为至少有多少个哨兵同意迁移的数量。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">实际情况下，哨兵不止一个。此处我们假设有10个哨兵。</span>
<span class="line">主观下线：哨兵会一直给主机发消息：在吗？   主机：在！   假设，没有得到主机的回应。说明主机可能挂了。但是也有可能网络有问题，哨兵发送的&quot;在吗？&quot;这个消息没有发出去。也有可能主机给你回复的&quot;在！&quot;你没收到。对于当前这一个烧饼而言，如果没有收到主机的回应，则这个哨兵就认为主机“主观下线”</span>
<span class="line">客观下线：一定数量的哨兵认为主机主观下线，我们就认定主机客观下线。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="_3-第三步-启动哨兵" tabindex="-1"><a class="header-anchor" href="#_3-第三步-启动哨兵"><span>（3）第三步: 启动哨兵</span></a></h4><ul><li><p>运行/usr/local/bin 下 redis-sentinel 命令,执行/root/myredis/sentinel.conf配置文件</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">redis-sentinel /root/myredis/sentinel.conf</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>redis做压测可以用自带的redis-benchmark工具</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line"># -c 指定并发连接数</span>
<span class="line"># -n 指定请求数</span>
<span class="line">redis-benchmark -h localhost -p 6379 -c 100 -n 10000</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_6-3-哨兵模式的操作演示" tabindex="-1"><a class="header-anchor" href="#_6-3-哨兵模式的操作演示"><span>6.3 哨兵模式的操作演示</span></a></h3><h4 id="_1-主机宕机演示" tabindex="-1"><a class="header-anchor" href="#_1-主机宕机演示"><span>（1）主机宕机演示</span></a></h4><ul><li>当主机宕机,会从从机中选择一个作为新的主机,根据优先级slave-properity, 原主机重启后会成为从机</li></ul><p><img src="/assets/image-20230706190854461-BGWKE6vi.png" alt="image-20230706190854461"></p><h4 id="_2-复制延时" tabindex="-1"><a class="header-anchor" href="#_2-复制延时"><span>（2）复制延时</span></a></h4><div class="language-纯文本 line-numbers-mode" data-highlighter="prismjs" data-ext="纯文本" data-title="纯文本"><pre><code><span class="line">由于所有的写操作都是先在Master上操作，然后同步更新到Slave上，所以从Master同步到Slave机器有一定的延迟，当系统很繁忙的时候，延迟问题会更加严重，Slave机器数量的增加也会使这个问题更加严重。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-故障恢复" tabindex="-1"><a class="header-anchor" href="#_3-故障恢复"><span>（3）故障恢复</span></a></h4><ul><li>优先级在redis.conf中默认：replica-priority 100，值越小优先级越高</li><li>偏移量是指获得原主机数据最全的</li><li>每个redis实例启动后都会随机生成一个40位的runid</li></ul><p><img src="/assets/%E5%9B%BE%E7%89%87_ZAx9ym8HMa-4lIoJagG.png" alt=""></p><h1 id="第十章-redis集群操作" tabindex="-1"><a class="header-anchor" href="#第十章-redis集群操作"><span>第十章 Redis集群操作</span></a></h1><h2 id="学习目标-8" tabindex="-1"><a class="header-anchor" href="#学习目标-8"><span>学习目标</span></a></h2><p>1 熟悉Redis中的集群模式特点</p><p>2 能够独立搭建Redis的集群</p><p>3 能够熟练操作集群</p><h2 id="_9-1-目前面临问题分析" tabindex="-1"><a class="header-anchor" href="#_9-1-目前面临问题分析"><span>9.1 目前面临问题分析</span></a></h2><ul><li>容量不够，redis如何进行扩容？</li><li>并发写操作， redis如何分摊？</li><li>另外，主从模式，薪火相传模式，主机宕机，导致ip地址发生变化，应用程序中配置需要修改对应的主机地址、端口等信息。</li><li>之前通过代理主机来解决，但是redis3.0中提供了解决方案。就是无中心化集群配置。</li></ul><h2 id="_9-2-什么是集群" tabindex="-1"><a class="header-anchor" href="#_9-2-什么是集群"><span>9.2 什么是集群</span></a></h2><blockquote><p>Redis 集群实现了对Redis的水平扩容，即启动N个redis节点，将整个数据库分布存储在这N个节点中，每个节点存储总数据的1/N。</p></blockquote><blockquote><p>Redis 集群通过分区（partition）来提供一定程度的可用性（availability ）：即使集群中有一部分节点失效或者无法进行通讯，集群也可以继续处理命令请求。</p></blockquote><h2 id="_9-3-集群的搭建" tabindex="-1"><a class="header-anchor" href="#_9-3-集群的搭建"><span>9.3 集群的搭建</span></a></h2><h3 id="_1-第一步-搭建前的准备" tabindex="-1"><a class="header-anchor" href="#_1-第一步-搭建前的准备"><span>（1）第一步,搭建前的准备</span></a></h3><ul><li>之前操作产生的rdb和aof文件删除</li><li>appendonly 修改回 no</li><li>清空主从复制和哨兵模式留下的一些文件</li><li>开启daemonize yes</li><li>protected-mode no</li><li>注释掉bind</li></ul><h3 id="_2-第二步-制作六个实例的配置文件" tabindex="-1"><a class="header-anchor" href="#_2-第二步-制作六个实例的配置文件"><span>（2）第二步,制作六个实例的配置文件</span></a></h3><ul><li><p>配置文件的内容</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">include /root/myredis/redis.conf</span>
<span class="line">port 6379</span>
<span class="line">pidfile &quot;/var/run/redis_6379.pid&quot;</span>
<span class="line">dbfilename &quot;dump6379.rdb&quot;</span>
<span class="line">cluster-enabled yes</span>
<span class="line">cluster-config-file nodes-6379.conf</span>
<span class="line">cluster-node-timeout 15000</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>内容解释</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">include /root/myredis/redis.conf #引用公共的配置文件</span>
<span class="line">port 6379 # 设置端口号</span>
<span class="line">pidfile &quot;/var/run/redis_6379.pid&quot; # 设置pid进程文件</span>
<span class="line">dbfilename &quot;dump6379.rdb&quot; # 设置rdb持久化文件名</span>
<span class="line">cluster-enabled yes # 开启集群</span>
<span class="line">cluster-config-file nodes-6379.conf # 设置集群使用的结点文件名</span>
<span class="line">cluster-node-timeout 15000 # 设置结点失联时间</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>创建6379 6380 6381 6389 6390 6391 六个结点的配置文件</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">创建一个配置文件后,进行复制即可,然后在vim下,通过 :%s/6379/目标端口 来批量替换每个配置文件中的端口号</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/assets/image-20230706200218897-DipQ8p5z.png" alt="image-20230706200218897"></p></li></ul><h3 id="_3-第三步-启动六个服务" tabindex="-1"><a class="header-anchor" href="#_3-第三步-启动六个服务"><span>（3）第三步,启动六个服务</span></a></h3><p><img src="/assets/image-20230706200143345-DlqUnUfn.png" alt="image-20230706200143345"></p><ul><li>组合之前，请确保所有redis实例启动后，nodes-xxxx.conf文件都生成正常。</li></ul><p><img src="/assets/image-20230706200315643-D8DpXxyD.png" alt="image-20230706200315643"></p><h3 id="_4-第四步-将六个服务合并为一个集群" tabindex="-1"><a class="header-anchor" href="#_4-第四步-将六个服务合并为一个集群"><span>（4）第四步 ,将六个服务合并为一个集群</span></a></h3><ul><li><p>切换目录到redis的src下</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">cd /opt/redis-7.0.10/src</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>运行如下指令</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">redis-cli --cluster create --cluster-replicas 1 192.168.6.131:6379 192.168.6.131:6380 192.168.6.131:6381 192.168.6.131:6382 192.168.6.131:6383 192.168.6.131:6384</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>此处不要用127.0.0.1， 请用真实IP地址 --replicas 1 采用最简单的方式配置集群，一台主机，一台从机，正好三组。</strong></p><p><img src="/assets/image-20230706200816752-BRRwijb4.png" alt="image-20230706200816752"></p><p>输入 yes 继续</p><p><img src="/assets/image-20230706200954694-YbwcPg99.png" alt="image-20230706200954694"></p></li></ul><h2 id="_9-4集群的登录" tabindex="-1"><a class="header-anchor" href="#_9-4集群的登录"><span>9.4集群的登录</span></a></h2><h3 id="_1-集群登录方式" tabindex="-1"><a class="header-anchor" href="#_1-集群登录方式"><span>（1）集群登录方式</span></a></h3><p><img src="/assets/%E5%9B%BE%E7%89%87_afL9Hz385B-BRCE9is6.png" alt=""></p><ul><li>登录指令添加 -c 代表以集群方式登录</li></ul><h3 id="_2-登录后查看集群信息" tabindex="-1"><a class="header-anchor" href="#_2-登录后查看集群信息"><span>（2）登录后查看集群信息</span></a></h3><ul><li><p>一个集群至少要有三个主节点。选项 --cluster-replicas 1 表示我们希望为集群中的每个主节点创建一个从节点。</p></li><li><p>分配原则尽量保证每个主数据库运行在不同的IP,每个从库和主库不在一个IP地址上。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">cluster nodes  # 查看集群节点信息</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><p><img src="/assets/image-20230706201216761-CITPv-0z.png" alt="image-20230706201216761"></p><h2 id="_9-5-集群的slots" tabindex="-1"><a class="header-anchor" href="#_9-5-集群的slots"><span>9.5 集群的slots</span></a></h2><p><img src="/assets/image-20230706201426691-CXMnaEEo.png" alt="image-20230706201426691"></p><ul><li>一个 Redis 集群包含 16384 个插槽（hash slot）， 数据库中的每个键都属于这 16384 个插槽的其中一个，</li><li>集群使用公式 CRC16(key) % 16384 来计算键 key 属于哪个槽， 其中 CRC16(key) 语句用于计算键 key 的 CRC16 校验和 。</li><li>集群中的每个节点负责处理一部分插槽。 举个例子， 如果一个集群可以有主节点， 其中： <ul><li>节点 A 负责处理 0 号至 5460 号插槽。</li><li>节点 B 负责处理 5461 号至 10922 号插槽。</li><li>节点 C 负责处理 10923 号至 16383 号插槽。</li></ul></li></ul><h2 id="_9-6-集群中录入值" tabindex="-1"><a class="header-anchor" href="#_9-6-集群中录入值"><span>9.6 集群中录入值</span></a></h2><ul><li>在redis-cli每次录入、查询键值，redis都会计算出该key应该送往的插槽，如果不是该客户端对应服务器的插槽，redis会报错，并告知应前往的redis实例地址和端口。</li><li>redis-cli客户端提供了 –c 参数实现自动重定向。</li><li>如 redis-cli -c –p 6379 登入后，再录入、查询键值对可以自动重定向。</li></ul><p><img src="/assets/image-20230706201647379-CrtSjmL6.png" alt="image-20230706201647379"></p><ul><li><p>不在一个slot下的键值，是不能使用mget,mset等多键操作。</p></li><li><p>可以通过{}来定义组的概念，从而使key中{}内相同内容的键值对放到一个slot中去。</p></li></ul><p><img src="/assets/image-20230706201756159-G4SA2S2O.png" alt="image-20230706201756159"></p><h2 id="_9-7-集群中查找值" tabindex="-1"><a class="header-anchor" href="#_9-7-集群中查找值"><span>9.7 集群中查找值</span></a></h2><ul><li>cluster keyslot key 计算key应该保存在那个插槽</li><li>cluster countkeysinslot slot的值 计算某个插槽中保存的key的数量</li><li>CLUSTER GETKEYSINSLOT &lt;slot&gt;&lt;count&gt; 返回 count 个 slot 槽中的键。</li></ul><p><img src="/assets/image-20230706202007674-CLERXb91.png" alt="image-20230706202007674"></p><h2 id="_9-8-集群故障恢复" tabindex="-1"><a class="header-anchor" href="#_9-8-集群故障恢复"><span>9.8 集群故障恢复</span></a></h2><ul><li>如果主节点下线？从节点能否自动升为主节点？注意：<strong>15秒超时</strong></li></ul><p><img src="/assets/image-20230706202459470-DnjlCvMg.png" alt="image-20230706202459470"></p><ul><li>主节点恢复后，主从关系会如何？主节点回来变成从机。</li></ul><p><img src="/assets/image-20230706202640635-CFkJEEiM.png" alt="image-20230706202640635"></p><ul><li>如果所有某一段插槽的主从节点都宕掉，redis服务是否还能继续? <ul><li>redis.conf中cluster-require-full-coverage 为yes 那么 ，整个集群都挂掉</li><li>redis.conf中cluster-require-full-coverage 为no 那么，只有该插槽数据全都不能使用。</li></ul></li></ul><h2 id="_9-9-集群提供的好处" tabindex="-1"><a class="header-anchor" href="#_9-9-集群提供的好处"><span>9.9 集群提供的好处</span></a></h2><ul><li>实现扩容</li><li>分摊压力</li><li>无中心配置相对简单</li></ul><h2 id="_9-10-集群的不足" tabindex="-1"><a class="header-anchor" href="#_9-10-集群的不足"><span>9.10 集群的不足</span></a></h2><ul><li>多键操作是不被支持的</li><li>多键的Redis事务是不被支持的。lua脚本不被支持</li><li>由于集群方案出现较晚，很多公司已经采用了其他的集群方案，而代理或者客户端分片的方案想要迁移至redis cluster，需要整体迁移而不是逐步过渡，复杂度较大。</li></ul></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 409732463@qq.com">GlobalXiaoHua</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DXtlDOGr.js" defer></script>
  </body>
</html>
